<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Nginx资源消耗低 | 壹拾陆</title><meta name="keywords" content="Linux"><meta name="author" content="壹拾陆"><meta name="copyright" content="壹拾陆"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Nginx 66 Nginx发展_哔哩哔哩_bilibili Nginx资源消耗低&#x2F;性能强官方提供的测试数据，Nginx能支持5W的并发连接，在实际生产环境下可支撑2~4W的并发连接数。 Apache使用的网络I&#x2F;O模型是传统的select模型，以Prefork多进程模式运转，需要经常派生子进程，消耗系统资源要比Nginx高得多。且一个进程在同一时间只会处理一个请求。 如Apa">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx资源消耗低">
<meta property="og:url" content="https://mo-li001.github.io/posts/2b73bc61.html">
<meta property="og:site_name" content="壹拾陆">
<meta property="og:description" content="Nginx 66 Nginx发展_哔哩哔哩_bilibili Nginx资源消耗低&#x2F;性能强官方提供的测试数据，Nginx能支持5W的并发连接，在实际生产环境下可支撑2~4W的并发连接数。 Apache使用的网络I&#x2F;O模型是传统的select模型，以Prefork多进程模式运转，需要经常派生子进程，消耗系统资源要比Nginx高得多。且一个进程在同一时间只会处理一个请求。 如Apa">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-08-31T12:41:14.000Z">
<meta property="article:modified_time" content="2023-02-09T17:27:14.284Z">
<meta property="article:author" content="壹拾陆">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mo-li001.github.io/posts/2b73bc61"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Nginx资源消耗低',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-10 01:27:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://images-1258700836.cos.ap-guangzhou.myqcloud.com/images/202209182232723.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">壹拾陆</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Nginx资源消耗低</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-31T12:41:14.000Z" title="发表于 2022-08-31 20:41:14">2022-08-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-09T17:27:14.284Z" title="更新于 2023-02-10 01:27:14">2023-02-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Nginx资源消耗低"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Nginx</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1QK41117ZF?p=1&vd_source=629395ac7befa1625191c3f496068941">66 Nginx发展_哔哩哔哩_bilibili</a></p>
<h3 id="Nginx资源消耗低-x2F-性能强"><a href="#Nginx资源消耗低-x2F-性能强" class="headerlink" title="Nginx资源消耗低&#x2F;性能强"></a>Nginx资源消耗低&#x2F;性能强</h3><p>官方提供的测试数据，Nginx能支持5W的并发连接，在实际生产环境下可支撑2~4W的并发连接数。</p>
<p>Apache使用的网络I&#x2F;O模型是传统的select模型，以Prefork多进程模式运转，需要经常派生子进程，消耗系统资源要比Nginx高得多。且一个进程在同一时间只会处理一个请求。</p>
<p>如Apache Web Server支撑这日均千万PV的网站，服务器平均负载在50<del>60,CPU消耗在70%</del>90%,而整体迁移到Nginx后，系统平均负载降低至1<del>4，CPU使用率在20%</del>40%，效果可见。</p>
<p>常见LNMP（linux、Nginx、Mysql、PHP)服务器在3万并发连接下，开启10个Nginx进程消耗不过<code>（15MB*10=150MB）</code>内存。就算开启64个php-cgi进程，也就消耗 <code>20MB*64=1280MB</code>，总共后台进程使用不到2GB内存，且服务器如果内存较小，开启php-cgi进程数量可以再少点。</p>
<p>在压力测试，3W的并发连接下，Nginx+PHP的程序任然能够飞速运转，从Nginx的日志统计下(每分钟的第15秒有多少条日志），单机处理请求能力在700次&#x2F;秒，那么日承受访问量在 <code>700*60*60*24=6048,0000</code>，且服务器的负载不会太高。</p>
<h3 id="Nginx成本低"><a href="#Nginx成本低" class="headerlink" title="Nginx成本低"></a>Nginx成本低</h3><p>Nginx强大功能其一在于反向代理、负载均衡，属于是软件负载均衡，企业购买硬件的<code>F5、NetScaler</code> 等硬件负载均衡设备价格昂贵，而Nginx属于开源软件，遵循BSD协议，可以免费试用，甚至二次开发用于商业用途。</p>
<h2 id="常见web服务器"><a href="#常见web服务器" class="headerlink" title="常见web服务器"></a>常见web服务器</h2><p>在linux和windows平台常见的web服务器有</p>
<ul>
<li>Apache,(国企性质，要求技术栈不需要那么先进，没有大量的流量，只需要系统架构稳定即可)</li>
<li>nginx(主流的互联网公司都选择使用nginx，淘宝，京东，美团，斗鱼，网易）</li>
<li>Lighttpd(性能非常接近nginx的一款web server,主要是老外在用)</li>
<li>Tomcat（应用服务器，java做程序解析）</li>
<li>IBM (websphere)</li>
</ul>
<p>windows平台下的</p>
<ul>
<li>IIS(internet information server )</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx+ uwsgi(python后台,做负载均衡)</span><br></pre></td></tr></table></figure>



<h3 id="apache"><a href="#apache" class="headerlink" title="apache"></a>apache</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apache是世界主流的web服务器，大部分网站都是apache搭建的，优势是开放源代码，开发维护的团队很强大，有好几十年</span><br><span class="line">的历史,apche支持跨平台应用(1inux,unix,windows)</span><br><span class="line"></span><br><span class="line">但是apache属于重量级的产品，功能都是以模块化定制，且它的工作模式，占用的内存资源过多，对系统消耗很大，性能也</span><br><span class="line">稍弱于nginx</span><br></pre></td></tr></table></figure>



<h3 id="lighttpd"><a href="#lighttpd" class="headerlink" title="lighttpd"></a>lighttpd</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">是一款高性能，高安全性，快速，且配置灵活的web服务器产品，。专门为高流量的网站设计，相比其他各款web服务器，内</span><br><span class="line">存占用量极小，能够提供有效的API，对cPo负载情况管理，支持后台请求转发，fastcgi,scgi，资源压缩，url重写，别</span><br><span class="line">名等等通能，它是nginx的重头对手之一</span><br></pre></td></tr></table></figure>



<h3 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tomcat汤姆猫是一个开源,运行基于java的一个web应用服务器，主要根据serverlet进行执行，但是tomcat对于平台文</span><br><span class="line">件，静态文件，高并发处理还是较弱，因此也是和nginx,apache结合使用。</span><br><span class="line">想要使用tomcat应用服务器，需要掌握基本的java环境部署等等</span><br></pre></td></tr></table></figure>



<h3 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">和nginx,apache,lightttp有哪些区别呢?</span><br><span class="line"></span><br><span class="line">IIS支持图形化操作，毕竟是在windows平台，通过鼠标点击就可以完成网站配置</span><br><span class="line">功能还是很强大，但是只能运行在windows平台</span><br></pre></td></tr></table></figure>



<h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">是俄罗斯人开发出的一款高性能HTTP web服务器，支持反向代理，负载均衡，资源压缩，ur1重写，网站跳转等等功能nginx以高效的linux网络模型，epoll,event，作为网络Io模型，kqueue，在高并发网站情况下，nginx能够轻松支持5w+的并发流量，并且消耗的服务器内存，cpu等资源，也是很低的，运行起来非常稳定。</span><br></pre></td></tr></table></figure>



<h3 id="技术架构"><a href="#技术架构" class="headerlink" title="技术架构"></a>技术架构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">收费技术栈：</span><br><span class="line">redhat + jqurey + js + svn + oracle +tomcat +java + apache</span><br><span class="line"></span><br><span class="line">省钱，走向开源技术栈：</span><br><span class="line">centos + jquery +js + git + mysql + java+tomcat +python+perl+ nginx</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">美企，比较有钱</span><br><span class="line"></span><br><span class="line">有钱的大公司，自己造机房，买服务器，数据都由自己管控，自己招聘IDc机房运维，linux系统运维，头条，百团，苹果</span><br><span class="line"></span><br><span class="line">中等公司，外企，自己购买服务器，服务器放在专业的机房托管（内部的内网业务，也有在自己公司搭建小型的服务器机房）</span><br><span class="line"></span><br><span class="line">小型公司，选择云服务器，是最经济实惠</span><br></pre></td></tr></table></figure>





<h3 id="Nginx特点"><a href="#Nginx特点" class="headerlink" title="Nginx特点"></a>Nginx特点</h3><h4 id="成本低"><a href="#成本低" class="headerlink" title="成本低"></a>成本低</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nginx强大在于其反向代理的功能，软件负载均衡，还存在硬件负载均衡(f5,netscaler)，但是由于价格昂贵，小型公司</span><br><span class="line">不会使用，利用nginx搭建高可用性的负载均衡的站点</span><br><span class="line">由于nginx支持bsd开源许可协议，bsd就是可以给用户更自由的使用权限，可以自由试用，修改源码，如果你修改后发布，</span><br><span class="line">还得遵循BSD协议.</span><br><span class="line">利用软件技术，可以实现硬件负载均衡一样的效果，经济实惠</span><br></pre></td></tr></table></figure>



<h3 id="几大优势"><a href="#几大优势" class="headerlink" title="几大优势"></a>几大优势</h3><ul>
<li>nginx配置文件更加易懂</li>
<li>nginx支持网站url地址重写（网站需要域名更换），还能够根据url的特点，进行一个请求转发，判断（7层负载均衡，比如判断来自于移动端请求，发给移动端服务器，判断是来自于PC端流量，用户请求就发给运行着PC端代码的服务器）</li>
<li>nginx支持高可用性配置(防止单点故障，服务器崩溃)，nginx非常稳定，宕机异常退出的几率很小</li>
<li>nginx能够节省网络带宽，支持静态文件压缩后传输，支持gzip压缩功能</li>
<li>nginx还支持热部署，可以在不停止nginx情况下更新代码，并且nginx支持7*24h运转，</li>
</ul>
<h3 id="学习nginx的网络模型"><a href="#学习nginx的网络模型" class="headerlink" title="学习nginx的网络模型"></a>学习nginx的网络模型</h3><h4 id="网络IO模型概念"><a href="#网络IO模型概念" class="headerlink" title="网络IO模型概念"></a>网络IO模型概念</h4><h5 id="内核空间，用户空间"><a href="#内核空间，用户空间" class="headerlink" title="内核空间，用户空间"></a>内核空间，用户空间</h5><p>内核空间：一个操作系统的核心组件，称之为内核，独立于普通的应用程序，可以直接操作底层硬件，处理系统受保护的区域</p>
<p>操作系统为了保护系统的核心区域，也就是内核，使得用户无法直接修改系统底层，因此操作系统就开辟了两块虚拟内存空间，</p>
<p>一是内核空间，二是用户空间</p>
<h5 id="进程切换"><a href="#进程切换" class="headerlink" title="进程切换"></a>进程切换</h5><p>为了控制进程的执行，操作系统的内核需要有能力挂起CPU上运行的程序（暂停一个CPU正在处理的进程），还能恢复之前已经挂起的进程，这种行为称之为进程切换</p>
<h5 id="进程阻塞"><a href="#进程阻塞" class="headerlink" title="进程阻塞"></a>进程阻塞</h5><p>正在执行中的进程，由于某些事件的等待，比如资源加载中，资源加载失败，操作系统自动的就会阻塞该进程，调用内核的block语句，让该进程处于阻塞状态，因此阻塞的进程是一种主动的行为。</p>
<h5 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h5><p>这是计算机科学里的一个术语，表示指向文件引用的一个抽象的概念，文件描述符是一个索引值，指向linux内核为每一个进程打开的文件做记录的一个表。</p>
<p>程序每打开一个文件，系统内核就向该进程发送一个文件描述符</p>
<h5 id="Linux-IO模型"><a href="#Linux-IO模型" class="headerlink" title="Linux IO模型"></a>Linux IO模型</h5><p>input 输入<br>output 输出</p>
<p>对于linux的文件读写操作</p>
<p>数据的IO操作，比如文件的读取，数据优先会被拷贝到操作系统的内核缓冲区，然后再冲缓冲区拷贝到应用程序的内存空间</p>
<p>这是属于本地文件的IO过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">一个读取操作，经历了两个阶段</span><br><span class="line">1.等待数据准备</span><br><span class="line">2.数据从内核空间拷贝到用户进程空间</span><br></pre></td></tr></table></figure>

<p>网络IO</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.等待网络上的数据分段到达，然后复制到内核的缓冲区</span><br><span class="line">2.数据从内核缓冲区拷贝到用户空间的应用程序</span><br><span class="line"></span><br><span class="line">网络应用主要面临两个问题，数据计算，网络IO延迟</span><br><span class="line"></span><br><span class="line">网络的延迟，是造成性能低下的最大的原因</span><br></pre></td></tr></table></figure>



<h3 id="为何选择Nginx"><a href="#为何选择Nginx" class="headerlink" title="为何选择Nginx"></a>为何选择Nginx</h3><p>nginx就是在于优秀的网络IO处理模型</p>
<p>常见的IO模型有</p>
<ul>
<li>阻塞模型</li>
<li>非阻塞模型</li>
<li>IO多路复用</li>
<li>异步IO</li>
</ul>
<p>网络IO指的就是在网络中进行数据的读，写操作，本质上就是一个socket套接字读取，socket套接字在linux系统中被抽象为流的概念，网络IO就是对数据流的处理。</p>
<h3 id="趣谈阻塞模型之（同步阻塞IO-block-IO）"><a href="#趣谈阻塞模型之（同步阻塞IO-block-IO）" class="headerlink" title="趣谈阻塞模型之（同步阻塞IO block IO）"></a>趣谈阻塞模型之（同步阻塞IO block IO）</h3><p>同步阻塞IO的特点是，io执行的两个阶段都是阻塞的，</p>
<p>​	用户空间发起调用，内核准备数据时，阻塞</p>
<p>​	内核拷贝数据到用户空间，此时阻塞</p>
<p>直到最终内核返回结果，数据拷贝完毕，用户进程接触block阻塞状态，重新的运行</p>
<p>在linux默认的情况下，所有的socket套接字操作都是阻塞的，阻塞指的就是进程在等待中，cpu此时去做别的事了</p>
<p>同步阻塞模型，主要优缺点如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.阻塞IO能够及时返回数据，无延迟</span><br><span class="line">2.对于开发人员负担较低，开发负担较低</span><br><span class="line">3.但是对于用户是很不友好的，性能较弱</span><br></pre></td></tr></table></figure>



<h3 id="同步非阻塞"><a href="#同步非阻塞" class="headerlink" title="同步非阻塞"></a>同步非阻塞</h3><p>同步非阻塞就是每隔一会检索一次，进行轮训调用的方式（你跟你媳妇去吃麦当劳，在你们点好餐，发起调用之后，餐厅开始准备食物，但是此时你又不愿意干等着，又去跟你媳妇逛了会优衣库，但是在逛街过程中，又害怕食材准备好了，来迟了，因此你们逛一会回来餐厅询问一下，好没好，如果没好，待会再来)</p>
<p>同步阻塞和非阻塞的区别</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.非阻塞的优点，在等待的时间内，可以继续处理其他的任务，当然也包括继续提交新的任</span><br><span class="line">2.非阻塞的缺点是，任务完成的延迟比较大，因为需要多次的发起系统轮训调用操作，并且粮有可能在任务轮训过程中，数据以及准备完毕了，造成延迟，对整体的系统吞吐性能有了降低</span><br></pre></td></tr></table></figure>



<h3 id="IO多路复用"><a href="#IO多路复用" class="headerlink" title="IO多路复用"></a>IO多路复用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">计算机系统后台可能存在N多个进程任务，如果能自动的循环的查询查询多个任务的进度，而不需要用户进程主动发起轮训调用，而是有人来帮忙盯着这些进度，那就很方便了</span><br><span class="line"></span><br><span class="line">因此linux系统下select,poll,epoll就是来帮你做盯着进程进度的一个软件，并且epoll效率是最高的，并且nginx就是使用的epoll网络io模型</span><br></pre></td></tr></table></figure>



<h3 id="select事件"><a href="#select事件" class="headerlink" title="select事件"></a>select事件</h3><p>select就是做自动轮训的这件事，它和非阻塞轮训的区别在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">其实IO多路复用和阻塞IO形式区别不大，并且有可能性能还更差一点，是因为IO多路复用还额外的调用了select事件，还有了额外的系统开销</span><br><span class="line">IO多路复用好处就是select事件可以同时处理多个连接</span><br><span class="line"></span><br><span class="line">如果你的服务器链接数不是很高的话，使用IO多路复用还不如用*（多线程+同步阻塞IO）来的效率更好</span><br><span class="line">1O多路复用优势在于可以同时处理更多的连接，而不是处理速度的优势</span><br></pre></td></tr></table></figure>



<h3 id="异步非阻塞IO模型"><a href="#异步非阻塞IO模型" class="headerlink" title="异步非阻塞IO模型"></a>异步非阻塞IO模型</h3><p>前几个网络IO模型的总结</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.阻塞和非阻塞的区别</span><br><span class="line">阻塞IO会一直阻塞对应的进程，直到数据操作完毕</span><br><span class="line">非阻塞IO是在内核空间准备数据的阶段会立即返回</span><br><span class="line"></span><br><span class="line">2.同步IO和异步IO的区别</span><br><span class="line">同步IO在进行IO操作的时候，进程会被阻塞</span><br><span class="line">异步IO，是在进程发起IO操作之后，内核直接返回，直到内核发送一个信号，告诉该进程IO操作完成了，整个进程完全是没有阻塞的。</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR;</span><br><span class="line">    Nginx基本语法--&gt;下载安装;</span><br><span class="line">    Nginx基本语法--&gt;配置语法;</span><br><span class="line">    Nginx基本语法--&gt;功能模块;</span><br><span class="line">    Nginx基本语法--&gt;日志功能;</span><br><span class="line">    Nginx基本语法--&gt;访问限制;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph LR;</span><br><span class="line">    Nginx功能实践--&gt;下载安装;</span><br><span class="line">    Nginx功能实践--&gt;静态站点;</span><br><span class="line">    Nginx功能实践--&gt;反向代理;</span><br><span class="line">    Nginx功能实践--&gt;负载均衡;</span><br><span class="line">    Nginx功能实践--&gt;缓存服务;</span><br><span class="line">    Nginx功能实践--&gt;动静态请求分离;</span><br><span class="line">    Nginx功能实践--&gt;HTTPS;</span><br><span class="line">    Nginx功能实践--&gt;LUA开发;</span><br><span class="line">    Nginx功能实践--&gt;Nginx安全;</span><br><span class="line">    Nginx功能实践--&gt;Nginx调优;</span><br></pre></td></tr></table></figure>





<h2 id="Nginx安装配置"><a href="#Nginx安装配置" class="headerlink" title="Nginx安装配置"></a>Nginx安装配置</h2><p>Nginx如今分为商业版，开源版，支持Linux与Windows平台下载使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx.com  商业版</span><br><span class="line">nginx.org  开源版</span><br><span class="line">https://tengine.taobao.org/</span><br></pre></td></tr></table></figure>

<p>【环境准备】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">操作系统：CentOS Linux release 7.3.1611（Core)</span><br><span class="line">GCC编译环境：yum install -y gcc gcc-c++ autoconf automake make</span><br><span class="line">模块依赖性：Nginx支持的功能模块需要有第三方的库支持，例如gzip的zlib库，rewrite重写需要的pcre库，HTTPS需要</span><br><span class="line">yum install zlib zlib-devel openssl openssl-devel pcre pcre-devel wget httpd-tools vim</span><br><span class="line"></span><br><span class="line">系统基础开发环境：yum groupinstall &quot;Development Tools&quot; &quot;Basic Web Server&quot;</span><br><span class="line"></span><br><span class="line">确保防火墙关闭  iptables –F</span><br><span class="line">关闭selinux</span><br><span class="line">yum源配置正确</span><br><span class="line">网络连接状态正常</span><br></pre></td></tr></table></figure>

<p>【Nginx下载】</p>
<ul>
<li>yum自动安装，不支持自由扩展第三方功能</li>
<li>源码编译安装</li>
</ul>
<h2 id="Nginx安装配置-1"><a href="#Nginx安装配置-1" class="headerlink" title="Nginx安装配置"></a>Nginx安装配置</h2><h3 id="nginx安装配置笔记"><a href="#nginx安装配置笔记" class="headerlink" title="nginx安装配置笔记"></a>nginx安装配置笔记</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1.操作系统的选择，centos7</span><br><span class="line">2.下载安装nginx的方式</span><br><span class="line">rpm包安装</span><br><span class="line">yum工具自动化安装</span><br><span class="line">获取源代码，手动编译安装nginx（指定安装路径，额外的开启nginx第三方的功能）</span><br><span class="line"></span><br><span class="line">3.选择了nginx编译安装，那么就得解决好1inux的编译开发环境，gcc make 编译工具</span><br><span class="line">使用yum工具之前，必须配置好阿里云的yum源</span><br><span class="line">步骤1：确保有wget命令</span><br><span class="line">yum install wget -y</span><br><span class="line">步骤2：备份旧的yum仓库文件</span><br><span class="line">mkdir /etc/yum.repos.d/repobak</span><br><span class="line">mv /etc/yum.repos.d/* /etc/yum.repos.d/repobak</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如上的操作，就是使得在yum仓库的一层目录，没有任何repo文件，因此就实现了linux此时没有yum源了，此时没有yum</span></span><br><span class="line">源，需要你再配置一个新的repo仓库文件</span><br><span class="line">可以访问阿里云的镜像站：https://developer.aliyun.com/mirror/</span><br><span class="line">用如下命令生成新的yum源，其实也就是下载了一个新的repo文件</span><br><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">情况旧的yum缓存</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成新的阿里云的yum缓存，</span></span><br><span class="line">yum makecache</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在配置了阿里云的yum源之后，来安装如下编译工具</span></span><br><span class="line">yum install -y gcc gcc-c++ autoconf automake make</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装使用nginx还得安装nginx所需的一些第三方系统库的支持，比如nginx的静态资源压缩功能所需的gzip lib库，nginx需要支持URL重写,所需的pcre库,perl开发的依赖库,以及nginx搭建加密站点 https,所需的openssl依赖库等</span></span><br><span class="line">yum install zlib zlib-devel openssl openssl-devel pcre pcre-devel wget httpd-tools vim -y</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装完毕nginx所需的基础依赖库，还得检查系统的防火墙是否关闭，selinux关闭，yum配置，网络情况等等</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行如下命令检查</span></span><br><span class="line">iptables -L</span><br><span class="line">getenforce</span><br><span class="line">ping baidu.com</span><br></pre></td></tr></table></figure>



<h3 id="编译安装nginx"><a href="#编译安装nginx" class="headerlink" title="编译安装nginx"></a>编译安装nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">1.下载程序源代码，从nginx官网下载的代码是源nginx代码</span><br><span class="line">wget http://nginx.org/download/nginx-1.17.10.tar.gz</span><br><span class="line"></span><br><span class="line">还可以获取淘宝的nginx代码</span><br><span class="line">http://tengine.taobao.org/ #淘宝nginx官网</span><br><span class="line">wget http://tengine.taobao.org/download/tengine-2.3.2.tar.gz</span><br><span class="line"></span><br><span class="line">2.解压缩淘宝nginx或者官网nginx源代码都行，自行选择</span><br><span class="line">[root@rsync01 opt]# tar -zxvf tengine-2.3.2.tar.gz</span><br><span class="line"></span><br><span class="line">3.解压缩nginx源代码后，进入源代码的目录，准备开始编译安装</span><br><span class="line">进入源代码目录后，查看目录下有哪些内容</span><br><span class="line">[root@db01 tengine-2.3.2]# ls -l</span><br><span class="line">总用量 380</span><br><span class="line">-rw-rw-r--  1 root root    889 9月   5 2019 AUTHORS.te</span><br><span class="line">drwxrwxr-x  6 root root   4096 9月   5 2019 auto       #检测系统模块依赖信息</span><br><span class="line">-rw-rw-r--  1 root root 298825 9月   5 2019 CHANGES    #存放nginx的变化记录日志</span><br><span class="line">-rw-rw-r--  1 root root  25609 9月   5 2019 CHANGES.cn</span><br><span class="line">-rw-rw-r--  1 root root  32748 9月   5 2019 CHANGES.te</span><br><span class="line">drwxrwxr-x  2 root root    184 9月   5 2019 conf       #存放nginx主配置文件的目录</span><br><span class="line">-rwxrwxr-x  1 root root   2502 9月   5 2019 configure  #可执行的脚本，用于释放编译文件的定制定制脚本</span><br><span class="line">drwxrwxr-x  4 root root    109 9月   5 2019 contrib    #提供了vim插件，让配置文件颜色区分，更友好</span><br><span class="line">drwxrwxr-x  4 root root     67 9月   5 2019 docs</span><br><span class="line">drwxrwxr-x  2 root root     40 9月   5 2019 html       #存放了标准的html页面文件</span><br><span class="line">-rw-rw-r--  1 root root   1715 9月   5 2019 LICENSE</span><br><span class="line">drwxrwxr-x  2 root root     21 9月   5 2019 man</span><br><span class="line">drwxrwxr-x 26 root root   4096 9月   5 2019 modules</span><br><span class="line">drwxrwxr-x  3 root root     20 9月   5 2019 packages</span><br><span class="line">-rw-rw-r--  1 root root   3421 9月   5 2019 README.markdown</span><br><span class="line">drwxrwxr-x 10 root root    103 9月   5 2019 src        #存放了nginx源代码的目录</span><br><span class="line">drwxrwxr-x  4 root root     43 9月   5 2019 tests</span><br><span class="line">-rw-rw-r--  1 root root     43 9月   5 2019 THANKS.te</span><br><span class="line"></span><br><span class="line">4.开始准备编译三部曲</span><br><span class="line">第一曲：进入软件源代码目录，执行编译脚本文件，如制定安装路径，以及开启额外功能等</span><br><span class="line">首先，查看编译脚本的信息</span><br><span class="line">[root@rsync01 tengine-2.3.2]# ./configure --help #查看编译帮助信息</span><br><span class="line">执行编译脚本文件，释放makefile等信息</span><br><span class="line">./configure --prefix=/opt/tngx232 --with-http_ssl_module --with-http_flv_module --with-http_gzip_static_module --with-http_stub_status_module --with-threads --with-file-aio</span><br><span class="line"></span><br><span class="line">第二曲：（直接开始下一步安装）输入make指令</span><br><span class="line">第三曲： (如同点击开始安装）make install</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">5.查看安装后的nginx目录</span><br><span class="line">[root@db01 ~]# cd /opt/tngx232/</span><br><span class="line">[root@db01 tngx232]# ls -l</span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x 2 root root 333 1月  21 14:22 conf  #conf 存放nginx的配置文件 如 nginx.conf</span><br><span class="line">drwxr-xr-x 2 root root  40 1月  21 14:22 html  #html 存放nginx的网页根目录文件，存放站点的静态文件数据</span><br><span class="line">drwxr-xr-x 2 root root   6 1月  21 14:22 logs  #logs 存放nginx的各种日志目录</span><br><span class="line">drwxr-xr-x 2 root root  19 1月  21 14:22 sbin  #sbin 存放该软件的可执行命令</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6.若是直接 执行nginx命令，默认是代表启动nginx进程</span><br><span class="line">[root@rsync01 ~]# nginx</span><br><span class="line">-bash：nginx：未找到命令</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">出现了如上的问题，如何解决？</span></span><br><span class="line">配置PATH变量，把nginx的sbin目录加入到pATH当中</span><br><span class="line">6.1 编写一个nginx的专属环境变量，创建一个脚本文件</span><br><span class="line">echo &#x27;export PATH=&quot;$PATH:/opt/tngx232/sbin/&quot;&#x27; &gt; /etc/profile.d/nginx.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">加载配置</span></span><br><span class="line">source /etc/profile.d/nginx.sh</span><br><span class="line"></span><br><span class="line">7.退出当前会话，重新登录，系统默认加载/etc/profile.d下所有的环境变量文件</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">退出会话后重新登录后，查看nginx的环境变量是否被添加了</span></span><br><span class="line">[root@db01 tngx232]# echo $PATH</span><br><span class="line">/application/mysql/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/opt/tngx232/sbin/</span><br><span class="line"></span><br><span class="line">8.此时可以快捷的使用nginx各种指令了</span><br><span class="line">nginx  #首次直接输入nginx，表示启动该进程，如果你再次启动则报错，端口被占用，注意这个坑</span><br><span class="line"></span><br><span class="line">[root@db01 tngx232]# netstat -lntup|grep 80</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      4550/nginx: master </span><br><span class="line"></span><br><span class="line">nginx -s stop  #可以停止nginx后，再次启动nginx服务，用于重新加载nginx配置</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果不想重启nginx,直接重新加载配置文件，nginx提供了一个reload功能,能够在不重启nginx服务下，直接重新读取配置文件功能</span></span><br><span class="line">nginx -s reload  #平滑重启</span><br><span class="line"></span><br><span class="line">9.此时检查nginx的编译安装信息</span><br><span class="line">[root@db01 tngx232]# nginx -V</span><br><span class="line">Tengine version: Tengine/2.3.2</span><br><span class="line">nginx version: nginx/1.17.3</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) </span><br><span class="line">built with OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix=/opt/tngx232 --with-http_ssl_module --with-http_flv_module --with-http_gzip_static_module --with-http_stub_status_module --with-threads --with-file-aio</span><br></pre></td></tr></table></figure>

<p>你在电脑上安装qq的过程</p>
<p>1.去qq官网下载安装包</p>
<p>2.在本地找到安装包，双击运行</p>
<p>3.默认的情况，双击安装包运行后，会立即出现指定安装路径的画面（如同linux源码安装的，第一曲）</p>
<p>4.指定完了安装路径，直接下一步，，，下一步即可。</p>
<p>5.最终qq安装完毕，去第三步指定的安装路径，去寻找qq的可执行文件即可，如qq.exe（发送快捷方式到桌面）</p>
<p>6.最终可以在桌面很方便的使用qq程序啦（转化为linux平台的动作，就是配置PATH环境变量）</p>
<h3 id="Nginx配置文件语法"><a href="#Nginx配置文件语法" class="headerlink" title="Nginx配置文件语法"></a>Nginx配置文件语法</h3><ul>
<li>nginx.conf由指令与指令块构成</li>
<li>每行语句由分号结束，指令和参数之间由空格分隔</li>
<li>指令块可以大括号{}组织多条指令块</li>
<li>配置文件中#号添加注释信息</li>
<li>支持<code>$变量</code>使用变量</li>
<li>支持include语句，组合多个配置文件</li>
<li>部分指令支持正则表达式，如rewrite重写指令</li>
</ul>
<h4 id="nginx-conf指令注释"><a href="#nginx-conf指令注释" class="headerlink" title="nginx.conf指令注释"></a>nginx.conf指令注释</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### Nginx配置文件nginx.conf中文详解 #####</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">定义Nginx运行的用户和用户组</span></span><br><span class="line">user www www;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx进程数，建议设置为等于CPU总核心数。</span></span><br><span class="line">worker_processes 8;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span></span><br><span class="line">error_log /usr/local/nginx/logs/error.log info;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进程pid文件</span></span><br><span class="line">pid /usr/local/nginx/logs/nginx.pid;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定进程可以打开的最大描述符：数目</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">工作模式与连接数上限</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这个指令是指当一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（ulimit-n）与nginx进程数相相除，但是nginx分配请求并不是那么均匀，所以最好与<span class="built_in">ulimit</span> -n 的值保持一致。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">现在在linux 2.6内核下开启文件打开数为65535,worker_rlimit_nofile就相应应该填写65535.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这是因为nginx调度时分配请求到进程并不是那么的均衡，所以假如填写10240，总并发量达到3-4万时就有进程可能超过10240了，这时会返回502错误。</span></span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line">events</span><br><span class="line">&#123;</span><br><span class="line">    #参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]；epoll模型</span><br><span class="line">    #是Linux 2.6以上版本内核中的高性能网络I/O模型，linux建议epoll，如果跑在FreeBSD上面，就用kqueue模型。</span><br><span class="line">    #补充说明:</span><br><span class="line">    #与apache相类，nginx针对不同的操作系统，有不同的事件模型</span><br><span class="line">    #A）标准事件模型</span><br><span class="line">    #Select、poll属于标准事件模型，如果当前系统不存在更有效的方法，nginx会选择select或poll</span><br><span class="line">    #B）高效事件模型</span><br><span class="line">    #Kqueue：使用于FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 和 MacOS X.使用双处理器的MacOS X系统使用kqueue可能会造成内核崩溃。</span><br><span class="line">    #Epoll：使用于Linux内核2.6版本及以后的系统。</span><br><span class="line">    #/dev/poll：使用于Solaris 7 11/99+，HP/UX 11.22+ (eventport)，IRIX 6.5.15+ 和 Tru64 UNIX 5.1A+。</span><br><span class="line">    #Eventport：使用于Solaris 10。 为了防止出现内核崩溃的问题， 有必要安装安全补丁。</span><br><span class="line">    use epoll;</span><br><span class="line">  </span><br><span class="line">    #单个进程最大连接数（最大连接数=连接数*进程数)</span><br><span class="line">    #根据硬件调整，和前面工作进程配合起来用，尽量大，但是别把cpu跑到100%就行。每个进程允许的最多连接数，理论上每台nginx服务器的最大连接数为。worker_processes*worker_connections</span><br><span class="line">    worker_connections 65535;</span><br><span class="line">  </span><br><span class="line">    #keepalive超时时间。</span><br><span class="line">    keepalive_timeout 60;</span><br><span class="line"></span><br><span class="line">    #客户端请求头部的缓冲区大小。这个可以根据你的系统分页大小来设置，一般一个请求头的大小不会超过1k，不过由于一般系统分页都要大于1k，所以这里设置为分页大小。</span><br><span class="line">    #分页大小可以用命令getconf PAGESIZE 取得。</span><br><span class="line">    #[root@web001 ~]# getconf PAGESIZE</span><br><span class="line">    #4096</span><br><span class="line">    #但也有client_header_buffer_size超过4k的情况，但是client_header_buffer_size该值必须设置为“系统分页大小”的整倍数。</span><br><span class="line">    client_header_buffer_size 4k;</span><br><span class="line"></span><br><span class="line">    #这个将为打开文件指定缓存，默认是没有启用的，max指定缓存数量，建议和打开文件数一致，inactive是指经过多长时间文件没被请求后删除缓存。</span><br><span class="line">    open_file_cache max=65535 inactive=60s;</span><br><span class="line"></span><br><span class="line">    #这个是指多长时间检查一次缓存的有效信息。</span><br><span class="line">    #语法:open_file_cache_valid time 默认值:open_file_cache_valid 60 使用字段:http, server, location 这个指令指定了多长时间检查一次open_file_cache中缓存项目的有效信息.</span><br><span class="line">    open_file_cache_valid 80s;</span><br><span class="line"></span><br><span class="line">    #open_file_cache指令中的inactive参数时间内文件的最少使用次数，如果超过这个数字，文件描述符一直是在缓存中打开的，如上例，如果有一个文件在inactive时间内一次没被使用，它将被移除。</span><br><span class="line">    #语法:open_file_cache_min_uses number 默认值:open_file_cache_min_uses 1 使用字段:http, server, location</span><br><span class="line">    open_file_cache_min_uses 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    fastcgi_connect_timeout 300;</span><br><span class="line">    fastcgi_send_timeout 300;</span><br><span class="line">    fastcgi_read_timeout 300;</span><br><span class="line">    fastcgi_buffer_size 64k;</span><br><span class="line">    fastcgi_buffers 4 64k;</span><br><span class="line">    fastcgi_busy_buffers_size 128k;</span><br><span class="line">    fastcgi_temp_file_write_size 128k;</span><br><span class="line">    </span><br><span class="line">    #gzip模块设置</span><br><span class="line">    gzip on; #开启gzip压缩输出</span><br><span class="line">    gzip_min_length 1k; #最小压缩文件大小</span><br><span class="line">    gzip_buffers 4 16k; #压缩缓冲区</span><br><span class="line">    gzip_http_version 1.0; #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</span><br><span class="line">    gzip_comp_level 2; #压缩等级</span><br><span class="line">    gzip_types text/plain application/x-javascript text/css application/xml;  #压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    </span><br><span class="line">    #开启限制IP连接数的时候需要使用</span><br><span class="line">    #limit_zone crawler $binary_remote_addr 10m;</span><br><span class="line"></span><br><span class="line">    #负载均衡配置</span><br><span class="line">    upstream server.com &#123;</span><br><span class="line"></span><br><span class="line">    #upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。</span><br><span class="line">    server 192.168.80.121:80 weight=3;</span><br><span class="line">    server 192.168.80.122:80 weight=2;</span><br><span class="line">    server 192.168.80.123:80 weight=3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    #nginx的upstream目前支持4种方式的分配</span><br><span class="line">    #1、轮询（默认)</span><br><span class="line">    #每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</span><br><span class="line">    #2、weight</span><br><span class="line">    #指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</span><br><span class="line">    #例如：</span><br><span class="line">    #upstream bakend &#123;</span><br><span class="line">    #    server 192.168.0.14 weight=10;</span><br><span class="line">    #    server 192.168.0.15 weight=10;</span><br><span class="line">    #&#125;</span><br><span class="line">    #2、ip_hash</span><br><span class="line">    #每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。</span><br><span class="line">    #例如：</span><br><span class="line">    #upstream bakend &#123;</span><br><span class="line">    #    ip_hash;</span><br><span class="line">    #    server 192.168.0.14:88;</span><br><span class="line">    #    server 192.168.0.15:80;</span><br><span class="line">    #&#125;</span><br><span class="line">    #3、fair（第三方）</span><br><span class="line">    #按后端服务器的响应时间来分配请求，响应时间短的优先分配。</span><br><span class="line">    #upstream backend &#123;</span><br><span class="line">    #    server serverl;</span><br><span class="line">    #    server server2;</span><br><span class="line">    #    fair;</span><br><span class="line">    #&#125;</span><br><span class="line">    #4、url_hash(第三方)</span><br><span class="line">    #按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。</span><br><span class="line">    #例：在upstream中加入hash语句，server语句中不能写入weight等其他的参数，hash_method是使用的hash算法</span><br><span class="line">    #upstream backend &#123;</span><br><span class="line">    #    server squial:3128;</span><br><span class="line">    #    server squid2:3128;</span><br><span class="line">    #    hash $request_uri;</span><br><span class="line">    #    hash_method crc32;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">    #tips:</span><br><span class="line">    #upstream bakend&#123;#定义负载均衡设备的Ip及设备状态&#125;&#123;</span><br><span class="line">    #    ip_hash;</span><br><span class="line">    #    server 127.0.0.1:9090 down;</span><br><span class="line">    #    server 127.0.0.1:8080 weight=2;</span><br><span class="line">    #    server 127.0.0.1:6060;</span><br><span class="line">    #    server 127.0.0.1:7070 backup;</span><br><span class="line">    #&#125;</span><br><span class="line">    #在需要使用负载均衡的server中增加 proxy_pass http://bakend/;</span><br><span class="line">    </span><br><span class="line">    #每个设备的状态设置为：</span><br><span class="line">    #1.down表示单前的server暂时不参与负载</span><br><span class="line">    #2.weight为weight越大，负载的权重就越大。</span><br><span class="line">    #3.max_fails:允许请求失败的次数默认为1.当超过最大次数时，返回proxy_next_upstream 模块定义的错误</span><br><span class="line">    #4.fail_timeout：max_fails次失败后,暂停的时间。</span><br><span class="line">    #5.backup：其它所有的非backup机器down或者忙的时候，请求backup机器。所以这台机器压力会最轻。</span><br><span class="line"></span><br><span class="line">    #nginx支持同时设置多组的负载均衡，用来给不用的server来使用。</span><br><span class="line">    #client_body_in_file_only设置为On 可以讲client post过来的数据记录到文件中用来做debug</span><br><span class="line">    #client_body_temp_path设置记录文件的目录可以设置最多3层目录</span><br><span class="line">    #location对URL进行匹配.可以进行重定向或者进行新的代理 负载均衡</span><br><span class="line"></span><br><span class="line">    #虚拟主机的配置</span><br><span class="line">    server</span><br><span class="line">    &#123;</span><br><span class="line">        #监听端囗</span><br><span class="line">        listen 80;</span><br><span class="line">        </span><br><span class="line">        #域名可以有多个，用空格隔开</span><br><span class="line">        server_name www.w3cschool.cn w3cschool.cn;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line">        root /data/www/w3cschool;</span><br><span class="line">        </span><br><span class="line">        #对******进行负载均衡</span><br><span class="line">        location ~.*.(php|php5)?$</span><br><span class="line">        &#123;</span><br><span class="line">            fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">            fastcgi_index index.php;</span><br><span class="line">            include fastcgi.conf;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        #图片缓存时间设置</span><br><span class="line">        location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 10d;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #JS和CSS缓存时间设置</span><br><span class="line">        location ~ .*.(js|css)?$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 1h;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    #日志格式设定</span><br><span class="line">    #$remote_addr与$http_x_forwarded_for用以记录客户端的ip地址；</span><br><span class="line">    #$remote_user:用来记录客户端用户名称;</span><br><span class="line">    #$time_local:用来记录访问时间与时区；</span><br><span class="line">    #$request:用来记录请求的url与http协议;</span><br><span class="line">    #$status:用来记录请求状态:成功是200,300,400,500</span><br><span class="line">    #$body bytes_sent :记录发送给客户端文件主体内容大小;</span><br><span class="line">    #$http_referer:用来记录从哪个页面链接访问过来的；</span><br><span class="line">    #$http_user_agent:记录客户浏览器的相关信息；</span><br><span class="line">    #通常web服务器放在反向代理的后面，这样就不能获取到客户的IP地址了，通过$remote_add拿到的IP地址是反向代理服务器的iP地址。反向代理服务器在转发请求的http头信息中，可以增加x_forwarded_for信息，用以记录原有客户端的IP地址和原来客户端的请求的服务器地址。</span><br><span class="line">    log_format access &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    &#x27;&quot;$http_user_agent&quot; $http_x_forwarded_for&#x27;;</span><br><span class="line">    </span><br><span class="line">    #定义本虚拟主机的访问日志</span><br><span class="line">    access_log /usr/local/nginx/logs/host.access.log main;</span><br><span class="line">    access_log /usr/local/nginx/logs/host.access.404.log log404;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    #对“/”启用反向代理</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:88;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        </span><br><span class="line">        #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        </span><br><span class="line">        #以下是一些反向代理的配置，可选。</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line"></span><br><span class="line">        #允许客户端请求的最大单文件字节数</span><br><span class="line">        client_max_body_size 10m;</span><br><span class="line">        </span><br><span class="line">        #缓冲区代理缓冲用户端请求的最大字节数，</span><br><span class="line">        #如果把它设置为比较大的数值，例如256k，那么，无论使用firefox还是IE浏览器，来提交任意小于256k的图片，都很正常。如果注释该指令，使用默认的client_body_buffer_size设置，也就是操作系统页面大小的两倍，8k或者16k，问题就出现了。</span><br><span class="line">        #无论使用firefox4.0还是IE8.0，提交一个比较大，200k左右的图片，都返回500 Internal Server Error错误</span><br><span class="line">        client_body_buffer_size 128k;</span><br><span class="line">        </span><br><span class="line">        #表示使nginx阻止HTTP应答代码为400或者更高的应答。</span><br><span class="line">        proxy_intercept_errors on;</span><br><span class="line">        </span><br><span class="line">        #后端服务器连接的超时时间▁发起握手等候响应超时时间</span><br><span class="line">        #nginx跟后端服务器连接超时时间（代理连接超时）</span><br><span class="line">        proxy_connect_timeout 90;</span><br><span class="line">        </span><br><span class="line">        #后端服务器数据回传时间（代理发送超时）</span><br><span class="line">        #后端服务器数据回传时间_就是在规定时间之内后端服务器必须传完所有的数据</span><br><span class="line">        proxy_send_timeout 90;</span><br><span class="line"></span><br><span class="line">        #连接成功后，后端服务器响应时间(代理接收超时）</span><br><span class="line">        #连接成功后_等候后端服务器响应时间_其实已经进入后端的排队之中等候处理（也可以说是后端服务器处理请求的时间）</span><br><span class="line">        proxy_read_timeout 90;</span><br><span class="line">        </span><br><span class="line">        #设置代理服务器(nginx）保存用户头信息的缓冲区大小</span><br><span class="line">        #设置从被代理服务器读取的第一部分应答的缓冲区大小，通常情况下这部分应答中包含一个小的应答头，默认情况下这个值的大小为指令proxy_buffers中指定的一个缓冲区的大小，不过可以将其设置为更小</span><br><span class="line">        proxy_buffer_size 4k;</span><br><span class="line">        </span><br><span class="line">        #proxy_buffers缓冲区，网页平均在32k以下的设置</span><br><span class="line">        #设置用于读取应答（来自被代理服务器）的缓冲区数目和大小，默认情况也为分页大小，根据操作系统的不同可能是4k或者8k</span><br><span class="line">        proxy_buffers 4 32k;</span><br><span class="line">        </span><br><span class="line">        #高负荷下缓冲大小(proxy_buffers*2)</span><br><span class="line">        proxy_busy_buffers_size 64k;</span><br><span class="line">        </span><br><span class="line">        #设置在写入proxy_temp_path时数据的大小，预防一个工作进程在传递文件时阻塞太长</span><br><span class="line">        #设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br><span class="line">        proxy_temp_file_write_size 64k;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        #所有静态文件由nginx直接读取不经过tomcat或resin</span><br><span class="line">        location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|×ls|mp3|wma)$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 15d;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ .*.(js|css)?$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 1h;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#### Nginx配置文件nginx.conf中文详解 #####</span></span></span><br></pre></td></tr></table></figure>

<h4 id="nginx-conf重要的指令块"><a href="#nginx-conf重要的指令块" class="headerlink" title="nginx.conf重要的指令块"></a>nginx.conf重要的指令块</h4><p>核心功能都在于http指令块里，http块还包含了以下指令</p>
<ul>
<li>server{}指令块，对应一个站点配置，反向代理，静态资源站点</li>
<li>location{}，对应一个url</li>
<li>upstream{}，定义上游服务，负载均衡池</li>
</ul>
<h3 id="Nginx命令行"><a href="#Nginx命令行" class="headerlink" title="Nginx命令行"></a>Nginx命令行</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1.nginx启停的指令，-s参数，指的是给nginx进程发送某种信号</span><br><span class="line">nginx  #初次启动，直接输入nginx，如启动后再执行该命令，就会提示端口冲突(停止nginx,再启动)</span><br><span class="line">nginx -s stop  #停止nginx进程</span><br><span class="line">nginx -s reload  #平滑重启，利用reload可以在不重启nginx进程的情况下,重新读取配置文件</span><br><span class="line"></span><br><span class="line">2.查看nginx命令的帮助信息</span><br><span class="line">[root@db01 tngx232]# nginx -h</span><br><span class="line">Tengine version: Tengine/2.3.2</span><br><span class="line">nginx version: nginx/1.17.3</span><br><span class="line">Usage: nginx [-?hvVtTq] [-s signal] [-c filename] [-p prefix] [-g directives]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -?,-h         : this help  #输出nginx的帮助信息</span><br><span class="line">  -v            : show version and exit  #列出nginx的版本号</span><br><span class="line">  -V            : show version and configure options then exit  #列出nginx版本和编译参数信息</span><br><span class="line">  -t            : test configuration and exit  #检查nginx的配置文件，语法是否正确</span><br><span class="line">  -T            : test configuration, dump it and exit  #同事检查配置，然后输出配置信息</span><br><span class="line">  -q            : suppress non-error messages during configuration testing  #在检测配置文件期间屏蔽非错误信息</span><br><span class="line">  -s signal     : send signal to a master process: stop, quit, reopen, reload  #给nginx主进程发送一个主信号,分别有 stop停止运行，quit, 优雅停止,relcad重读配置件,reopen重新记录nginx日志</span><br><span class="line">  -p prefix     : set prefix path (default: /opt/tngx232/)  #设置nginx目录前缀</span><br><span class="line">  -c filename   : set configuration file (default: conf/nginx.conf)  # nginx -c /opt/mynginx.conf  指定配置文件启动</span><br><span class="line">  -g directives : set global directives out of configuration file   #覆盖设置一些默认参数</span><br><span class="line"></span><br><span class="line">  -m            : show all modules and exit  #列出nginx所有支持的模块</span><br><span class="line">  -l            : show all directives and exit  #列出nginx目录相关的信息</span><br></pre></td></tr></table></figure>



<h2 id="nginx命令行案例"><a href="#nginx命令行案例" class="headerlink" title="nginx命令行案例"></a>nginx命令行案例</h2><h3 id="配置文件重读"><a href="#配置文件重读" class="headerlink" title="配置文件重读"></a>配置文件重读</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.检查当前的nginx进程</span><br><span class="line">ps -ef|grep nginx</span><br><span class="line"></span><br><span class="line">2.修改nginx.conf修改配置参数</span><br><span class="line"></span><br><span class="line">3.重新加载nginx配置</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>



<h3 id="nginx-master信号传递"><a href="#nginx-master信号传递" class="headerlink" title="nginx-master信号传递"></a>nginx-master信号传递</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.master主进程是不处理请求的，而是分配请求发给worker进程，主进程负责重启，热加载，热部署等等</span><br><span class="line">2.master是根据nginx.conf中 worker_process定义启动时创建的工作进程数</span><br><span class="line">3.当worker运行后，master就处于一个等待的状态，等待用户的请求来临，或者系统信号</span><br><span class="line">4.系统管理员可以发送kill指令，或者nginx -s 信号，这样的形式操控nginx</span><br></pre></td></tr></table></figure>



<p>nginx信号集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nginx -s 对应的信号功能如下</span><br><span class="line"></span><br><span class="line">参数     信号    含义</span><br><span class="line">stop    TERM    强制关闭nginx服务</span><br><span class="line">null    INT     强制关闭整个nginx服务</span><br><span class="line">guit    QUIT    优雅的关闭整个服务</span><br><span class="line">reopen  USR1    重新打开日志记录</span><br><span class="line">reload  HUB     重新读取配置文件，并且优雅的退出旧的worker</span><br></pre></td></tr></table></figure>





<h2 id="nginx热部署功能"><a href="#nginx热部署功能" class="headerlink" title="nginx热部署功能"></a>nginx热部署功能</h2><p>nginx作为一个优秀的web服务器，优秀的反向代理服务器，并且nginx也支持高可用的特性，nginx还支持热部署的特点。</p>
<p>热部署的特点：在不重启或者关闭进程的情况下，新的应用直接替换旧的应用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">更换nginx的二进制命令版本</span><br><span class="line">热部署大致流程</span><br><span class="line">1.备份旧的程序二进制文件 备份nginx命令，/opt/tngx232/sbin/nginx</span><br><span class="line">2.编译安装新的二进制文件，覆盖旧的二进制文件，（再装一个版本的nginx,且替换旧的nginx命令)</span><br><span class="line">3.发送USR2信号发给旧的master进程</span><br><span class="line">4.发送WINCH信号给旧的master进程</span><br><span class="line">5.发送QUIT信号给旧的master进程</span><br></pre></td></tr></table></figure>

<p>nginx还提供了热部署功能，特点是：在不影响用户体验下，进行软件版本升级，也就是不主动的杀死worker，就能够更换软件的二进制命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">1.准备旧的nginx程序版本</span><br><span class="line">[rootersync01 ~]# nginx -v</span><br><span class="line">Tengine version: Tengine/2.3.2</span><br><span class="line">nginx version: nginx/1.17.3</span><br><span class="line"></span><br><span class="line">2.备份旧的二进制命令</span><br><span class="line">[root@db01 ~]# cd /opt/tngx232/sbin/</span><br><span class="line">[root@db01 sbin]# mv nginx nginx.232</span><br><span class="line"></span><br><span class="line">3.检查旧的二进制命令的编译参数</span><br><span class="line">[root@rsync01 sbin]# nginx.232 -V</span><br><span class="line">Tengine version: Tengine/2.3.2</span><br><span class="line">nginx version: nginx/1.17.3</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) </span><br><span class="line">built with OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix=/opt/tngx232 --with-http_ssl_module --with-http_flv_module --with-http_gzip_static_module --with-http_stub_status_module --with-threads --with-file-aio</span><br><span class="line"></span><br><span class="line">4.下载编译安装新版本的nginx</span><br><span class="line">wget http://tengine.taobao.org/download/tengine-2.2.0.tar.gz</span><br><span class="line">tar -zxvf tengine-2.2.0.tar.gz</span><br><span class="line">进行编译安装</span><br><span class="line">cd tengine-2.2.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新版本的nginx编译参数和旧的保持一致，</span></span><br><span class="line">./configure --prefix=/opt/tngx232 --with-http_ssl_module --with-http_flv_module --with-http_gzip_static_module --with-http_stub_status_module --with-threads --with-file-aio</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编译三部曲，后两步</span></span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">5.检查一下新版的nginx信息</span><br><span class="line">[root@db01 tengine-2.2.0]# cd /opt/tngx232/sbin/</span><br><span class="line">[root@db01 sbin]# ls</span><br><span class="line">dso_tool  nginx  nginx.232</span><br><span class="line"></span><br><span class="line">6.再次检查当前系统的nginx状态</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过 pid  ppid可以验证,worker process是由master process创建的</span></span><br><span class="line">[root@db01 sbin]# ps -ef|grep nginx</span><br><span class="line">root       4550      1  0 1月21 ?       00:00:00 nginx: master process nginx</span><br><span class="line">nobody     4551   4550  0 1月21 ?       00:00:00 nginx: worker process</span><br><span class="line">root       9610   6270  0 16:58 pts/0    00:00:00 grep --color=auto nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7.此时发送一个USR2信号给旧的master process，租用是使得nginx旧的版本停止接收用户请求，并且切换为新的nginx版本</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行如下命令，给旧的nginx发送信号</span></span><br><span class="line">kill -USR2 `cat /opt/tngx232/logs/nginx.pid`</span><br><span class="line">当执行完毕上述的民拿过来，nginx-masterl旧的，首先会重命名它的pid文件，然后添加上.oldbin后缀</span><br><span class="line">然后会再启动一个新的master主进程，以及worker，使用的是新版本的nginx二进制命令，</span><br><span class="line">此时新的nginx就能够自动的接收用户发来的请求，过度到新的nginx-worker工作进程上，</span><br><span class="line">因此实现了一个平滑过度</span><br><span class="line"></span><br><span class="line">8.此时再次检查新的nginx进程状态</span><br><span class="line">[root@db01 sbin]# ps -ef|grep nginx</span><br><span class="line">root       4550      1  0 1月21 ?       00:00:00 nginx: master process nginx</span><br><span class="line">nobody     4551   4550  0 1月21 ?       00:00:00 nginx: worker process</span><br><span class="line">root       9627   6270  0 17:05 pts/0    00:00:00 grep --color=auto nginx</span><br><span class="line"></span><br><span class="line">9.此时发送WINCH信号，给旧的master进程，让旧的master进程优雅的退出</span><br><span class="line">kill -WINCH `cat /opt/tngx232/logs/nginx.pid.oldbin`</span><br><span class="line"></span><br><span class="line">10.此时如果你觉得nginx服务一切正常，就可以干掉旧的master主进程了</span><br><span class="line">ki11 111137</span><br><span class="line"></span><br><span class="line">11.此时nginx版本热部署，热更换实验就结束了~</span><br></pre></td></tr></table></figure>



<h3 id="nginx热部署操作"><a href="#nginx热部署操作" class="headerlink" title="nginx热部署操作"></a>nginx热部署操作</h3><p>nginx工作模式是master-worker(包工头—干活工人)</p>
<p>刚才所所的nginx支持reload重载，仅仅是nginx的master进程，在检查配置文件正确之后，正则则更新，错误则返回异常，正确的情况下也不会更改已经建立的worker,只会等待worker处理完毕请求之后，杀死旧的worker，然后再从新的配置文件中，运行处新的worker（一旦更换了配置文件，reload mster主进程，那么手底下的工人也就会被换一批了)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="Nginx日志切割"><a href="#Nginx日志切割" class="headerlink" title="Nginx日志切割"></a>Nginx日志切割</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">1.针对nginx的访客日志进行切割</span><br><span class="line">[root@db01 tngx232]# cd /opt/tngx232/logs</span><br><span class="line">[root@db01 logs]# ll -h</span><br><span class="line">总用量 8.0K</span><br><span class="line">-rw-r--r-- 1 root root  434 1月  21 14:37 access.log</span><br><span class="line">-rw-r--r-- 1 root root 1.5K 1月  22 17:05 error.log</span><br><span class="line"></span><br><span class="line">2.给当前日志文件重命名，注意使用mv命令</span><br><span class="line">[root@rsync01 logs]# mv access.log &quot;access.log_$(date +&quot;%Y-%m-%d&quot;)&quot;</span><br><span class="line"></span><br><span class="line">3.发给信号给nginx主进程，给他发送一个重新打开的信号，让nginx生成新的日志文件</span><br><span class="line">nginx -s reopen  #这个命令等同于 kill -USR1 `cat nginx.pid`</span><br><span class="line"></span><br><span class="line">4.注意在以上的nginx重命名日志切割链，不要着急立即对文件修改，而是要注意等待几秒钟，因为nginx的工作模式特点，master下发指令给worker去干活，刚发指令的时候只是一个标记，当业务量很大的时候，这个修改操作可能会有点慢，不会立即生效。</span><br><span class="line"></span><br><span class="line">5.在生产环境下，日志切割主要是以定时任务的形式来操作</span><br><span class="line">编写一个定时日志切割的脚本</span><br><span class="line">vim cut_nginx_log.sh  #写入如下内容</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">脚本写入crontab,每天0点执行,这是一个nginx日志切割脚本</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx日志存放点</span></span><br><span class="line">logs_path=&quot;/opt/tngx232/logs/&quot;</span><br><span class="line">mkdir -p $&#123;logs_path&#125;$(date -d &quot;yesterday&quot; +&quot;%Y&quot;)/$(date -d &quot;yesterday&quot; +&quot;%m&quot;)</span><br><span class="line">mv $&#123;logs_path&#125;access.log $&#123;logs_path&#125;$(date -d &quot;yesterday&quot; +&quot;%Y&quot;)/$(date -d &quot;yesterday&quot; +&quot;%m&quot;)/access_$(date -d &quot;yesterday&quot; +&quot;%Y-%m-%d&quot;).log</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">也能换成 nginx -s reopen</span></span><br><span class="line">kill -USR1 `cat /opt/tngx232/logs/nginx.pid`</span><br><span class="line"></span><br><span class="line">6.把该脚本的执行，加入crontab 每天o点执行</span><br><span class="line">crontab -e  #打开定时任务</span><br><span class="line"></span><br><span class="line">0 0 * * * /bin/bash /myscripts/cut_nginx_log.sh</span><br></pre></td></tr></table></figure>





<h2 id="nginx虚拟主机"><a href="#nginx虚拟主机" class="headerlink" title="nginx虚拟主机"></a>nginx虚拟主机</h2><p>虚拟主机指的就是一个独立的站点配置，是nginx默认支持的一个功能，它能够有自己独立的域名，独立的ip，独立的端口配置，能够配置完整的www服务，例如网站搭建，ftp服务搭建，邮件服务器代理等等。</p>
<p>并且nginx支持多虚拟主机，可以在一台机器上，同时运行多个网站的功能。</p>
<p>nginx的多虚拟主机，可以基于</p>
<ul>
<li>多域名的形式</li>
<li>多ip的形式</li>
<li>多端囗的形式</li>
</ul>
<p>利用虚拟主机的功能，就不用为了运行一个网站，而单独的配置一个nginx服务器，或者单独的再运行一组nginx进程。</p>
<p>利用nginx的多虚拟主机配置，我们就可以基于一台服务器，一个nginx进程，实现多个站点的配置</p>
<h3 id="nginx单虚拟主机的配置"><a href="#nginx单虚拟主机的配置" class="headerlink" title="nginx单虚拟主机的配置"></a>nginx单虚拟主机的配置</h3><h4 id="nginx静态网站的搭建"><a href="#nginx静态网站的搭建" class="headerlink" title="nginx静态网站的搭建"></a>nginx静态网站的搭建</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">nginx.conf</span><br><span class="line"></span><br><span class="line">user www;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx核心功能块</span></span><br><span class="line">http &#123;</span><br><span class="line">    #在http&#123;&#125;标签里面就可以定义虚拟主机</span><br><span class="line">    #nginx.conf中server&#123;&#125;虚拟主机标签的定义，默认加载顺序是自上而下的匹配规则（如果没有其他规则定义的情况，如基于域名的匹配，基于端口的匹配）</span><br><span class="line">    #第一个虚拟主机站点</span><br><span class="line">    server &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    #在平级关系内，编写第二个，第三个，，，，第N个server&#123;&#125;就是代表配置多个虚拟主机</span><br><span class="line">    #一个server&#123;&#125;标签就可以理解为是一个网站</span><br><span class="line">    server &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    #编写第三个网站的配置</span><br><span class="line">        server &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    #配置文件，虚拟主机站点介绍如下</span><br><span class="line">    #nginx.conf通过server关键字来定义虚拟主机</span><br><span class="line">    #nginx.conf支持编写多个server&#123;&#125;标签</span><br><span class="line">    #nginx.conf第一个虚拟主机站点配置如下</span><br><span class="line">    server &#123;</span><br><span class="line">        #定义虚拟主机站点的端口号，也是用户访问网站的入口</span><br><span class="line">        listen 80;</span><br><span class="line">        #填写虚拟主机的域名配置，没有域名就可以写 localhost 或者 _ 也行</span><br><span class="line">        server_name localhost;</span><br><span class="line">        #server_name www.chaoge.cc;</span><br><span class="line">        #给nginx定义网站的编码</span><br><span class="line">        charset utf-8;</span><br><span class="line">        #access_log logs/host.access.log main;</span><br><span class="line">        #access_log &quot;pipe:rollback logs/host.access_log interval=ld baknum=7 maxsize=2G&quot; main;</span><br><span class="line">        # nginx的路径匹配规则</span><br><span class="line">        #如下的规则是最低级匹配，任何的nginx请求，都会进入如下location的配置，去它所定义的目录中寻找资料</span><br><span class="line">        location / &#123;</span><br><span class="line">            # root关键词 是定义网页根目录的，这个html是以nginx安装的路径为相对</span><br><span class="line">            root html;</span><br><span class="line">            # index关键词，定义nginx的首页文件名字，默认找那个文件</span><br><span class="line">            index index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2.创建新的网页站点资料</span><br><span class="line"></span><br><span class="line">3.改了配置文件，一定要重新加载nginx，读取配置</span><br></pre></td></tr></table></figure>



<h3 id="Nginx静态资源压缩"><a href="#Nginx静态资源压缩" class="headerlink" title="Nginx静态资源压缩"></a>Nginx静态资源压缩</h3><p>nginx支持gzip对资源压缩传输，经过gzip压缩后的页面大小可以为原本的30%甚至更小，用户浏览体验会快很多。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.首先准备好nginx服务，以及配置好虚拟主机站点，再准备好一些静态数据</span><br><span class="line">-rw-r--x-- 1 root root 27M 4月 27 14:59 cc.txt</span><br><span class="line"></span><br><span class="line">2.此时在没有开启gzip压缩的情况下，访问该txt文本，发现加载速度很慢</span><br><span class="line"></span><br><span class="line">3.开启nginx的gzip压缩功能，只需要在httpf&#125;配置中，打开如下参数即可</span><br><span class="line">http &#123;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">     gzip on;</span><br><span class="line">     gzip_http_version 1.1;</span><br><span class="line">     gzip_comp_level 4;</span><br><span class="line">     gzip_types text/plain application/javascript applicatioh x-javascript text/css</span><br><span class="line">application/xml text/javaseript application/x-httpd-php image/jpeg image/gif image/png;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Nginx基于IP的多虚拟主机"><a href="#Nginx基于IP的多虚拟主机" class="headerlink" title="Nginx基于IP的多虚拟主机"></a>Nginx基于IP的多虚拟主机</h2><p>环境的准备</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">准备好linux机器，以及配置好3个ip地址</span><br><span class="line"># 给网络设备添加别名，绑定多个ip</span><br><span class="line">ifconfig eth0:1 10.0.0.145 netmask 255.255.255.0 broadcast 10.0.0.255 up</span><br><span class="line">ifconfig eth0:2 10.0.0.146 netmask 255.255.255.0 broadcast 10.0.0.255 up</span><br><span class="line"></span><br><span class="line">准备好的ip地址信息如下</span><br><span class="line">[root@db01 ~]# ifconfig |grep &quot;inet 10&quot;</span><br><span class="line">        inet 10.0.0.111  netmask 255.255.255.0  broadcast 10.0.0.255</span><br><span class="line">        inet 10.0.0.145  netmask 255.255.255.0  broadcast 10.0.0.255</span><br><span class="line">        inet 10.0.0.146  netmask 255.255.255.0  broadcast 10.0.0.255</span><br></pre></td></tr></table></figure>

<p>添加nginx的配置，添加多个server标签，让nginx支持基于IP的多虚拟主机，返回多个站点内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">1.给nginx添加inlucde包含语法，让其他目录下的配置文件参数，导入到nginx.conf中，这样的写法，能够让nginx每一个配置文件，看起来更简洁，更清晰</span><br><span class="line"></span><br><span class="line">修改nginx.conf，在http&#123;&#125;标签中的最后一行，添加如下参数，extra文件夹和nginx.conf文件夹为相对</span><br><span class="line">include extra/*.conf;</span><br><span class="line"></span><br><span class="line">2.在extra目录下，添加多个基于ip的虚拟主机配置</span><br><span class="line"></span><br><span class="line">可以像如下规划的形式，来编写nginx.conf配置文件</span><br><span class="line">第一个基于IP的虚拟主机，写在conf/nginx.conf 部分代码如下，当10.0.0.111请求到来，让nginx去/www/111文件夹下寻找资料</span><br><span class="line">listen 10.0.0.111:80;</span><br><span class="line">server_name localhost;</span><br><span class="line">location / &#123;</span><br><span class="line">    root /www/111;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3.在添加10.0.0.145虚拟主机的配置</span><br><span class="line">vim extra/145.conf，添加如下代码</span><br><span class="line">server &#123;</span><br><span class="line">    listen 10.0.0.145:80;</span><br><span class="line">    server_name _;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /www/145;</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">4.编辑 146.conf，添加如下代码</span><br><span class="line">server &#123;</span><br><span class="line">    listen 10.0.0.146:80;</span><br><span class="line">    server_name _;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /www/146;</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">5.检查nginx语法是否正确</span><br><span class="line">[root@db01 ~]# nginx -t</span><br><span class="line">nginx: the configuration file /opt/tngx232/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /opt/tngx232/conf/nginx.conf test is successful</span><br><span class="line"></span><br><span class="line">6.重新加载nginx配置</span><br><span class="line">nginx -s reload</span><br><span class="line"></span><br><span class="line">6.重新加载nginx配置，改了较多的nginx配置，在允许重启nginx的情况下</span><br><span class="line">nginx -s stop</span><br><span class="line"></span><br><span class="line">nginx</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">防止出现nginx有缓存的情况，发现页面无变化</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7.准备3个基于ip的站点内容</span><br><span class="line">mkdir -p /www/&#123;111,145,146&#125;</span><br><span class="line">echo &quot;I&#x27;m 111,hello man.&quot; &gt; /www/111/index.html</span><br><span class="line">echo &quot;I&#x27;m 145,hello man.&quot; &gt; /www/145/index.html</span><br><span class="line">echo &quot;I&#x27;m 156,hello man.&quot; &gt; /www/146/index.html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">8.先在linux本地测试多ip的虚拟主机</span><br><span class="line">[root@db01 ~]# curl 10.0.0.111</span><br><span class="line">[root@db01 ~]# curl 10.0.0.145</span><br><span class="line">[root@db01 ~]# curl 10.0.0.146</span><br><span class="line"></span><br><span class="line">9.使用客户端的浏览器查看效果</span><br></pre></td></tr></table></figure>



<h2 id="Nginx基于多域名的虚拟主机配置"><a href="#Nginx基于多域名的虚拟主机配置" class="headerlink" title="Nginx基于多域名的虚拟主机配置"></a>Nginx基于多域名的虚拟主机配置</h2><p>基于多IP的虚拟主机，用的还是不多的，还可能造成IP不足等问题，一般如果没有特殊需求，用的更多，且更方便的是基于多域名的虚拟主机</p>
<p>前提使用条件，要么配置DNS服务器，将你想用的域名解析到对应的ip</p>
<p>使用本地的hosts文件，进行本地测试访问</p>
<p>多域名的配置结合nginx，就是先了多虚拟主机的访问，解决了可能IP不足的问题</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">1.环境准备，先在你的客户端本地，修改hosts文件信息</span><br><span class="line">C:\Windows\System32\drivers\etc</span><br><span class="line"></span><br><span class="line">2.修改hosts文件，添加如下信息，注意这里是客户端本地添加的域名</span><br><span class="line">10.0.0.111 learn_nginx.com</span><br><span class="line">10.0.0.111 learn_nginx_cc.com</span><br><span class="line">10.0.0.111 learn_nginx_yy.com</span><br><span class="line"></span><br><span class="line">3.修改服务端的nginx配置</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第一个域名的虚拟主机</span></span><br><span class="line">cat &gt; /opt/tngx232/conf/extra/learn_nginx.conf&lt;&lt;EOF</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name learn_nginx.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /www/learn_nginx;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第二个域名的虚拟主机</span></span><br><span class="line">cat &gt; /opt/tngx232/conf/extra/learn_nginx_cc.conf&lt;&lt;EOF</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name learn_nginx_cc.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /www/learn_nginx_cc;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第三个域名的虚拟主机</span></span><br><span class="line">cat &gt; /opt/tngx232/conf/extra/learn_nginx_yy.conf&lt;&lt;EOF</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name learn_nginx_yy.com;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /www/learn_nginx_yy;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">4.进行nginx重启</span><br><span class="line">[root@db01 tngx232]# nginx -t</span><br><span class="line">nginx: the configuration file /opt/tngx232/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /opt/tngx232/conf/nginx.conf test is successful</span><br><span class="line"></span><br><span class="line">nginx -s stop</span><br><span class="line">nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.分别准备3个域名的虚拟主机站点资料</span><br><span class="line">mkdir -p /www/&#123;learn_nginx,learn_nginx_cc,learn_nginx_yy&#125;</span><br><span class="line"></span><br><span class="line">6.生成三点虚拟主机站点的首页内容</span><br><span class="line">echo &quot;I&#x27;m website learn_nginx, welcome----&quot;  &gt; /www/learn_nginx/index.html</span><br><span class="line">echo &quot;I&#x27;m website learn_nginx_cc, welcome----cccccc&quot;  &gt; /www/learn_nginx_cc/index.html</span><br><span class="line">echo &quot;I&#x27;m website learn_nginx_yy, welcome----yyyyyy&quot;  &gt; /www/learn_nginx_yy/index.html</span><br><span class="line"></span><br><span class="line">7.通过客户端浏览器，分别访问3个域名，查看站点内容</span><br></pre></td></tr></table></figure>



<h2 id="Nginx支持基于多端口的虚拟主机配置"><a href="#Nginx支持基于多端口的虚拟主机配置" class="headerlink" title="Nginx支持基于多端口的虚拟主机配置"></a>Nginx支持基于多端口的虚拟主机配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">只需要修改nginx.conf中</span><br><span class="line">server&#123;&#125;标签里面定义的</span><br><span class="line">listen端口 参数即可，实现不同的端口，进行的虚拟主机匹配</span><br><span class="line"></span><br><span class="line">10.0.0.111:80</span><br><span class="line">10.0.0.111:85</span><br><span class="line">10.0.0.111:90</span><br><span class="line"></span><br><span class="line">基于不同的端口，来定义为到不同的server 虚拟主机的配置~~</span><br></pre></td></tr></table></figure>



<h2 id="Nginx访客日志"><a href="#Nginx访客日志" class="headerlink" title="Nginx访客日志"></a>Nginx访客日志</h2><p>日志对于程序员是很重要的，可以用于问题排错，记录程序运行时的状态，一个好的日志配置，能够给与运维人员，开发人员精准的问题定位功能。</p>
<p>Nginx开启日志功能只需要在nginx.conf里面找到log_format参数，定义日志的格式，以及定义日志的存储位置，以及日志的格式，路径，缓存大小等等。</p>
<p>可以定义在全局配置中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">nginx.conf配置目志功能的代码如下，修改为如下即可</span><br><span class="line"></span><br><span class="line"># nginx web功能的核心配置点</span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    # 定义日志的内容格式（记录内容的详细程度）</span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line">    #access_log  &quot;pipe:rollback logs/access_log interval=1d baknum=7 maxsize=2G&quot;  main;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nginx的访客日志内容如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">10.0.0.111 - - [31/Jan/2023:18:03:26 +0800] &quot;GET / HTTP/1.1&quot; 200 19 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot;</span><br><span class="line"></span><br><span class="line">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">remote_addr 记录访客的客户端ip地址</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">remote_user 记录远程客户端的访客用户名</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">time_local 记录访间的时间和地区信息</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">request 记录用户的http请求的首行信息</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">status 记录用户的http请求状态，也就是请求发出之后，响应的状态，如 200 301 404 502</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">body_bytes_sent 记录服务器发给客户端的响应体数据字节大小</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">http_referer 记录本次请求是从哪个链接过来的，可以个根据refer信息来进行防盗链信息</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">http_user_agent 记录客户端的访问信息，如浏览器信息，手机浏览器信息</span></span><br><span class="line">&quot;$http_x_forwarded_for&quot; 捉到藏在代理服务器后面的真实客户端ip信息</span><br></pre></td></tr></table></figure>

<h2 id="Nginx多虚拟主机日志定义"><a href="#Nginx多虚拟主机日志定义" class="headerlink" title="Nginx多虚拟主机日志定义"></a>Nginx多虚拟主机日志定义</h2><p>不同的ip</p>
<p>不同的端口</p>
<p>不同的域名</p>
<p>都能够访问到一台计算机的配置，nginx的多虚拟主机的功能配置，利用虚拟主机可以在一台服务器上，运行多个站点配置。</p>
<p>针对每一个虚拟主机都配置好access.log更方便更清晰的对每一个虚拟主机进行访客信息管理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">针对虚拟主机，添加日志的路径</span></span><br><span class="line">cat &gt; /opt/tngx232/conf/extra/learn_nginx_cc.conf&lt;&lt;EOF</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name learn_nginx_cc.com;</span><br><span class="line">    access_log logs/learn_nginx_cc.log;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /www/learn_nginx_cc;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">第二个虚拟主机的配置</span></span><br><span class="line">cat &gt; /opt/tngx232/conf/extra/learn_nginx_yy.conf&lt;&lt;EOF</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name learn_nginx_yy.com;</span><br><span class="line">    access_log logs/learn_nginx_yy.log;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /www/learn_nginx_yy;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检测nginx语法</span></span><br><span class="line">[root@db01 ~]# nginx -t</span><br><span class="line">nginx: the configuration file /opt/tngx232/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /opt/tngx232/conf/nginx.conf test is successful</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新读取配置文件</span></span><br><span class="line">nginx -s reload</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">此时就生成了针对不同的虚拟主机站点的日志文件</span></span><br><span class="line">[root@db01 logs]# ll</span><br><span class="line">总用量 28</span><br><span class="line">-rw-r--r-- 1 root root 11822 1月  31 22:01 access.log</span><br><span class="line">-rw-r--r-- 1 root root 11205 2月   1 00:02 error.log</span><br><span class="line">-rw-r--r-- 1 root root     0 2月   1 00:01 learn_nginx_cc.log</span><br><span class="line">-rw-r--r-- 1 root root     0 2月   1 00:02 learn_nginx_yy.log</span><br><span class="line">-rw-r--r-- 1 root root     5 1月  31 18:02 nginx.pid</span><br></pre></td></tr></table></figure>



<h2 id="Nginx目录浏览功能"><a href="#Nginx目录浏览功能" class="headerlink" title="Nginx目录浏览功能"></a>Nginx目录浏览功能</h2><p>能够将你的机器上的目录资料，提供一个展示，无论是谁都可以快速的访问</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">修改nginx.cont配置，这个功能是在虚拟主机里定义的</span><br><span class="line">cat &gt; /opt/tngx232/conf/extra/learn_nginx_cc.conf&lt;&lt;&#x27;EOF&#x27;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name learn_nginx_cc.com;</span><br><span class="line">        access_log logs/learn_nginx_cc.log;</span><br><span class="line">        # 让nginx虚拟主机支持中文解析</span><br><span class="line">        charset utf-8;</span><br><span class="line">        # 域名匹配，所以的请求都会进入如下的目录解析</span><br><span class="line">        location / &#123;</span><br><span class="line">            root /www/learn_nginx_cc;</span><br><span class="line">            # 关闭虚拟主机的默认首页功能</span><br><span class="line">            # index  index.html;</span><br><span class="line">            # 自动的展示root所定义的目录下所有文件内容</span><br><span class="line">            autoindex on;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">2.还得检查虚拟主机目录下，不要存在index.html文件</span><br><span class="line">mv /www/learn_nginx_cc/index.html index.html.bak</span><br><span class="line">touch nginx非常好用.txt</span><br><span class="line">echo 感谢大家的聆听 &gt; nginx非常好用.txt</span><br></pre></td></tr></table></figure>



<h2 id="Nginx状态信息功能"><a href="#Nginx状态信息功能" class="headerlink" title="Nginx状态信息功能"></a>Nginx状态信息功能</h2><p>nginx提供了status模块，用于检测nginx的请求连接信息，这个功能需要在编译安装nginx的时候，添加<code>--with-http-stud-status_module</code>参数，才能使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -V #检查当前nginx是否支持status功能</span><br></pre></td></tr></table></figure>

<p>当你支持status功能，我们可以添加一个conf配置文件，用于检查状态页的功能</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">创建一个status.conf,放入extra目录下</span><br><span class="line"></span><br><span class="line">1.确保你的nginx.conf主配置文件，支持include语法</span><br><span class="line"></span><br><span class="line">include extra/*.conf;  #将当前的extra目录下所有的conf文件，都识别为是nginx的配置文件</span><br><span class="line"></span><br><span class="line">2.创建status.conf</span><br><span class="line">touch /opt/tngx232/conf/extra/status.conf</span><br><span class="line"></span><br><span class="line">3.修改status.conf 开启状态页面功能，添加如下内容</span><br><span class="line">cat &gt; /opt/tngx232/conf/extra/status.conf&lt;&lt;&#x27;EOF&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入如下内容</span></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 85;</span><br><span class="line">        location / &#123;</span><br><span class="line">            stub_status on;  #开启状态页功能</span><br><span class="line">            access_log off;  #关闭访客日志功能</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4.检查nginx配置，重启nginx</span><br><span class="line">nginx -t</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>

<p>访问nginx状态页</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@db01 learn_nginx_cc]# curl 10.0.0.111:85</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看到如下内容</span></span><br><span class="line">Active connections: 1  #显示正在处理的活动的，连接数</span><br><span class="line">server accepts handled requests request_time</span><br><span class="line"> 22 22 35 0</span><br><span class="line">Reading: 0 Writing: 1 Waiting: 0 </span><br><span class="line"></span><br><span class="line">server  #nginx启动后一共处理的请求数</span><br><span class="line">accepts handled  #nginx启动后创建的握手数</span><br><span class="line">requests  #表示nginx一共处理了多少次的请求</span><br><span class="line"></span><br><span class="line">Reading  #nginx读取到客户端的headers数量</span><br><span class="line">Writing  #nginx响应给客户端的headers数量</span><br><span class="line">Waiting  #nginx处理完毕请求之后，等待下一次的请求驻留的连接数</span><br><span class="line">waiting值=active-(reading+writing)</span><br></pre></td></tr></table></figure>

<p>使用ab命令，对nginx进行压力测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.安装ab命令</span><br><span class="line">yum install httpd-tools -y</span><br><span class="line"></span><br><span class="line">2.使用ab命令对nginx发送大量的连接</span><br><span class="line">-n  请求数量  #一共发出多少个请求 -n 10000</span><br><span class="line">-c  请求并发数  -c 100</span><br><span class="line">-k  #表示启动keepalived保持连接功能</span><br><span class="line"></span><br><span class="line">ab -kc 1000 -n 100000 http://127.0.0.1/</span><br></pre></td></tr></table></figure>



<h2 id="Nginx错误日志"><a href="#Nginx错误日志" class="headerlink" title="Nginx错误日志"></a>Nginx错误日志</h2><p>nginx能够把自身运行时故障的信息，也写入到对应的日志文件中，称之为<code>error_log</code></p>
<p>对于错误信息的调试，也是运维人员维护nginx的一个重要的手段</p>
<p>nginx想要使用<code>error_log</code>就得打开<code>nginx.conf</code>，找到关键字参数<code>error_log</code>,它是放在http称之为全局的变量参数，针对所有的server{}虚拟主机生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">nginx.conf</span><br><span class="line"></span><br><span class="line">user  www;</span><br><span class="line">...</span><br><span class="line">http &#123;</span><br><span class="line">    ...</span><br><span class="line">    error_log  logs/cc_error.log;</span><br><span class="line">    server &#123;</span><br><span class="line">        error_log  logs/s1_error.log;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        error_log  logs/s2_error.log;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">错误日志的语法</span><br><span class="line">error_log  file  level;</span><br><span class="line"></span><br><span class="line">日志级别有如下几种</span><br><span class="line">debug</span><br><span class="line">info</span><br><span class="line">notice</span><br><span class="line">warn</span><br><span class="line">error</span><br><span class="line">crit</span><br><span class="line">alert</span><br><span class="line">emerg</span><br><span class="line">这个级别是越来越严重，级别写的越低，记录的日志越详细，没有必要。。。</span><br><span class="line">级别越高，日志记录的内容就越少，生产环境下常用的是warn,error,crit模式</span><br><span class="line">日志的级别，可能会给服务器增加额外的大量IO消耗，因此，根据你实际的工作环境需求修改</span><br></pre></td></tr></table></figure>

<p>针对虚拟主机添加错误日志的部分代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    # 定义虚拟主机站点的端囗号，也是用户访问网站的入口</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  learn_nginx.com;</span><br><span class="line">    #server_name  www.chaoge.cc;</span><br><span class="line">    # 给nginx定义网站的编码</span><br><span class="line">    charset utf-8;</span><br><span class="line">    # 针对虚拟主机，单独指定错误日志文件</span><br><span class="line">    error_log  logs/cc_error.log;</span><br><span class="line">    #access_log  logs/host.access.log  main;</span><br><span class="line">    #access_log  &quot;pipe:rollback logs/host.access_log interval=1d baknum=7 maxsize=2G&quot;  main;</span><br><span class="line">    # nginx的路径匹配规则</span><br><span class="line">    # 如下的规则是最低级匹配，任何的nginx请求，都会进入如下location的配置，去它所定义的目录中寻找资料</span><br><span class="line">    location / &#123;</span><br><span class="line">        # root关键词 是定义网页根目录的，这个html是以nginx安装的路径为相对</span><br><span class="line">        root  /www/learn_nginx;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="Nginx-location匹配"><a href="#Nginx-location匹配" class="headerlink" title="Nginx location匹配"></a>Nginx location匹配</h2><p>nginx的location作用，是根据用户访问的url,进行不同的处理方式</p>
<p>针对用户请求的网站URL进行匹配处理，然后进行对应的处理</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">locaitn在nginx.conf的写法</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        # root关键词 是定义网页根目录的，这个html是以nginx安装的路径为相对</span><br><span class="line">        root  /www/learn_nginx;</span><br><span class="line">        # index关键词，定义nginx的首页文件名字，默认找那个文件</span><br><span class="line">        index  index.html index.htm;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>location相关语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">location [ = | ~ | ~* | ^~ ] url &#123;</span><br><span class="line">    # 做出的相应的处理动作</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx有关1ocaiton的匹配符号如下</span></span><br><span class="line">匹配符   匹配规则                                              优先级</span><br><span class="line">=        精确匹配                                              1</span><br><span class="line">^~       以某个字符开头不做正则处理                              2</span><br><span class="line">~*       支持正则的匹配模式                                     3</span><br><span class="line">/blog/   当你访问 10.0.0.111/blog/xxxx                         4</span><br><span class="line">/        通用匹配，不符合其他的locaiton的匹配规则，就走到这里     5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">表示nginx.conf支持在虚拟主机中定义多个location,进行用户的请求ur1解析</span><br><span class="line">server &#123;</span><br><span class="line">    location = &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~* &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>nginx的location实战演练如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">准备一个nginx的配置文件，来联系1ocaiton语法</span><br><span class="line">vim my_location.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们可以访问 IP:83 进入如下的虚拟主机</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 83;</span><br><span class="line">    server_name _;</span><br><span class="line">    </span><br><span class="line">    #最低级匹配，不符合其他locaiton就来这</span><br><span class="line">    #比如当用户访问 10.0.0.111:83/qweqwdqweqweqweqwe,nginx直接返回401状态码给用户</span><br><span class="line">    location / &#123;</span><br><span class="line">        return 401;</span><br><span class="line">    &#125;</span><br><span class="line">    #优先级最高，精确匹配，当用户访问 10.0.0.111:83/</span><br><span class="line">    location = / &#123;</span><br><span class="line">        return 402;</span><br><span class="line">    &#125;</span><br><span class="line">    #当用户访问 10.0.0.111:83//blog/hehe.txt</span><br><span class="line">    #以/blog/开头的url,来这里，如符合其他locaiton,则以其他优先</span><br><span class="line">    location /blog/ &#123;</span><br><span class="line">        return 403;</span><br><span class="line">    &#125;</span><br><span class="line">    # 当用户访问 10.0.0.111:83/img/xxxx</span><br><span class="line">    # 匹配任何以/img/开头的请求，不匹配正则</span><br><span class="line">    location ^~ /img/ &#123;</span><br><span class="line">        return 404;</span><br><span class="line">    &#125;</span><br><span class="line">    # 支持正则的匹配url</span><br><span class="line">    # 当用户访问任意url，结尾是以 .gif .jpg .jpeg的时候，就进入如下location</span><br><span class="line">    # 匹配任何以.gif结尾的请求，支持正则</span><br><span class="line">    location ~* \.(gif|jpg|jpeg)$ &#123;</span><br><span class="line">        return 500;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Nginx的url地址重写功能"><a href="#Nginx的url地址重写功能" class="headerlink" title="Nginx的url地址重写功能"></a>Nginx的url地址重写功能</h2><p>Nginx的url地址重写功能，主要是使用nginx提供的<code>rewrite</code>功能，且支持正则表达式</p>
<p>rewrite能够实现url的跳转，实现url规范化，根据请求的变量实现url跳转等等，基于url重写功能常见的效果如下</p>
<ul>
<li>对于爬虫程序的封禁，让其跳转到一个错误的页面</li>
<li>动态的url，伪装成静态的html页面，便于搜索引擎的抓取</li>
<li>新旧域名的更新，替换，<a target="_blank" rel="noopener" href="http://www.oldboyedu.com/">www.oldboyedu.com</a> &gt; <a target="_blank" rel="noopener" href="http://www.oldboyedu.com.cn/">www.oldboyedu.com.cn</a>.</li>
</ul>
<p>rewrite语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">rewrite  ^/(.*) http://192.168.178.134/$1  parmanent;</span><br><span class="line"></span><br><span class="line">＃解释</span><br><span class="line">rewrite 是nginx地址重写的关键词指令，开启跳转功能</span><br><span class="line">正则 ^/(.*) 表示匹配所有的请求，匹配成功后，跳转到后面指定的ur1地址</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">1 是取出前面正则表达式分组括号里的内容</span></span><br><span class="line">parmanment 表示301 重定向的标记</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>rewrite结尾的参数标记如下</p>
<ul>
<li>Last 规则匹配完成后，继续向下匹配新的locaiton</li>
<li>break 本条规则匹配完成后，立即停止匹配动作</li>
<li>Redirct 返回302临时重定向状态码，浏览器地址栏显示跳转后的url，爬虫不会更新该url</li>
<li>Permanent,返回301永久重定向，浏览器地址也显示跳转后的url，爬虫更新该网站url</li>
</ul>
<p>last和break用于实现url重写，浏览器的地址栏不会发生变化</p>
<p>redirct和permanent也是用于url跳转，浏览器url地址栏发生边变化，跳转到新的url地址栏</p>
<h3 id="实现一个301-URL跳转"><a href="#实现一个301-URL跳转" class="headerlink" title="实现一个301 URL跳转"></a>实现一个301 URL跳转</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">准备一个虚拟主机的配置文件，实现，当用户访问该虚拟主机，直接跳转到百度页面</span></span><br><span class="line"></span><br><span class="line">vim extra/learn_rewrite.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen  90;</span><br><span class="line">    server_name _;</span><br><span class="line">    #最低级请求配，所有请求都走到这里</span><br><span class="line">    location / &#123;</span><br><span class="line">        rewrite  ^/(.*)  http://www.baidu.com/$1  permanent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Nginx访问认证"><a href="#Nginx访问认证" class="headerlink" title="Nginx访问认证"></a>Nginx访问认证</h2><p>nginx提供了认证模块，语法是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    auth_basic &#x27;string&#x27;;</span><br><span class="line">    auth_basic_user_file conf/htpasswd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">linux提供了密码生成命令</span><br><span class="line">htpasswd 是apache提供的密码生成工具，nginx也支持auth_basic模块，因此我们可以利用Htpasswd命令生成账号密码文件，提供给nginx去使用</span><br><span class="line"></span><br><span class="line">yum install httpd-tools -y</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">语法</span></span><br><span class="line">htpasswd -bc .access username password</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解释</span></span><br><span class="line">-b  在命令行中输入 账号密码</span><br><span class="line">-c  创建密码文件</span><br><span class="line">username  账号</span><br><span class="line">password  密码</span><br><span class="line"></span><br><span class="line">默认.access文件采用加密方式md5来验证</span><br></pre></td></tr></table></figure>

<p>实际操作案例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.准备一个用于练习认证模块的配置文件，注意，还未制定密码文件</span><br><span class="line">server &#123;</span><br><span class="line">    listen 84;</span><br><span class="line">    server_name _;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html/www;</span><br><span class="line">        index index.html;</span><br><span class="line">        auth_basic &quot;learn nginx auth_module&quot;;</span><br><span class="line">        #nginx会去这个文件中验证账号密码</span><br><span class="line">        auth_basic_user_file /opt/tngx232/conf/extra/htpasswd;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生成密码文件</p>
<p>在当前目录，生成一个htpasswd密码文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -bc ./htpasswd chaoge 666</span><br></pre></td></tr></table></figure>

<p>生成首页，访问10.0.0.111:84</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/tngx232/html/www/index.html&lt;&lt;&#x27;EOF&#x27;</span><br><span class="line">&lt;meta charset=utf8&gt;</span><br><span class="line">感谢大家的聆听，希望大家好好学学nginx，很重要，下一节课再会~~~</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>



<h2 id="LNMP架构"><a href="#LNMP架构" class="headerlink" title="LNMP架构"></a>LNMP架构</h2><p>lamp架构(Linux+Apache+mysql(mariadb)+php&#x2F;python)</p>
<p>Redhat + apache + mysql,orcla + php&#x2F;java</p>
<p>lnmp(linux+nginx+mysql+php)</p>
<p>Centos 7</p>
<h2 id="lnmp"><a href="#lnmp" class="headerlink" title="lnmp"></a>lnmp</h2><p>1.在创业初期，研发经费有限，研发人力成本也是有限，技术储备也有限，因此需要选择一个易于维护，简单的技术架构</p>
<p>2.产品需要快速研发上线，并且能够快速满足用户的新的需求，现实情况决定了一开始，没有太多的精力来选择一个过于复杂的分布式架构，研发速度只需要一个字，快</p>
<p>3.创业初期，业务的复杂度还是较低，业务量也比较小，如果选择过于复杂的架构，返回会增加研发难度，以及运维难度</p>
<p>4.遵循选择合适的技术架构，而不是过分的追求新兴技术，权衡研发效率和产品目标，同事创业初期，只有一个PHP研发人员，过于复杂的技术架构，毕然会给程序员带来高昂的学习成本。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">用户层  Android  IOS  PC</span><br><span class="line">接入层  Nginx</span><br><span class="line">系统层  数据支撑后台  管理后台</span><br><span class="line">存储层  mysql  redis/mencached</span><br></pre></td></tr></table></figure>

<p>lnmp架构就是最适合初创型公司</p>
<p>一般初创型的小公司，使用Inmp架构，最少三台服务器足以，Nginx可以和后台程序直接部署在同一台机器上</p>
<p>mysql数据库单独一台服务器</p>
<p>mencached缓存数据库单独一台服务器</p>
<p>这样的架构，优势在于</p>
<ul>
<li>单体架构，架构很简单，清晰的分层结构</li>
<li>可以快速的研发，满足产品快速迭代的需求</li>
<li>没有复杂的技术架构，技术学习成本较低，同时运维成本也较低，不需要再单独招聘一个运维同学，节省公司的开支</li>
</ul>
<h2 id="LNMP组合搭建"><a href="#LNMP组合搭建" class="headerlink" title="LNMP组合搭建"></a>LNMP组合搭建</h2><p>lnmp工作流</p>
<p>1.用户通过浏览器输入域名访问到nginx web服务器</p>
<p>2.nginx进行用户请求判断（location url匹配的功能）静态请求则nginx直接响应给用户，如果是动态请求比如.php结尾，那么nginx就会通过<code>fastcgi接口</code>把请求转发给php后台程序的引擎（php-fpm进程），php进行动态请求解析（获取数据库中的内容，要登录，注册），php解析发现请求还要读取数据库，就会再通过php连接数据库，然后读取完毕之后返回给nginx，最终nginx把数据响应给用户客户端。</p>
<h2 id="LNMP部署之Nginx部署"><a href="#LNMP部署之Nginx部署" class="headerlink" title="LNMP部署之Nginx部署"></a>LNMP部署之Nginx部署</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1.安装形式选择</span><br><span class="line">yum</span><br><span class="line">  自动下载软件包及其依赖关系，自动化安装，省时省力</span><br><span class="line">  都是默认的安装路径，以及版本不容易指定，自定制化太低，无法扩展第三方新功能</span><br><span class="line">rpm包</span><br><span class="line">  需要手动解决依赖关系，弃用</span><br><span class="line">源代码编译安装</span><br><span class="line">  自由下载软件版本，自定制安装路径，第三方功能扩展</span><br><span class="line">  源代码编译安装步骤稍微复杂点</span><br><span class="line">  </span><br><span class="line">2.安装nginx前的系统依赖环境检查及其安装</span><br><span class="line">yum install pcre pcre-devel openssl openssl-devel gcc -y</span><br><span class="line"></span><br><span class="line">3.下载nginx原代码包，taobao nginx ,nginx官网源码</span><br><span class="line">wget http://nginx.org/download/nginx-1.16.0.tar.gz</span><br><span class="line"></span><br><span class="line">4.解压缩，源代码包</span><br><span class="line">[root@web02 mytools]# tar -zxvf nginx-1.16.0.tar.gz</span><br><span class="line"></span><br><span class="line">5.创建普通的nginx用户，用于运行nginx进程，降低nginx的系统权限</span><br><span class="line">useradd nginx -u 1111 -s /sbin/nologin -M</span><br><span class="line"></span><br><span class="line">6.开始编译安装nginx服务</span><br><span class="line">./configure --user=nginx --group=nginx --prefix=/mytools/nginx116/ --with-http_stub_status_module --with-http_ssl_module &amp;&amp; make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">7.最好给nginx配置一个软连接，这是生产环境常用的操作，便于运维，开发，测试一起使用，也便于日后的nginx升级</span><br><span class="line">[root@web02 mytools]# ln -s /mytools/nginx116/ /mytools/nginx</span><br><span class="line"></span><br><span class="line">8.配置nginx环境变量，快捷使用</span><br><span class="line">[root@web02 mytools]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line"></span><br><span class="line">添加nginx的bin目录到pATH中，且写入到环境变量文件中，开机就能够自动读取了 /etc/profile</span><br><span class="line">PATH=&quot;$PATH:/mytools/nginx/sbin&quot;</span><br></pre></td></tr></table></figure>





<h2 id="LNMP环境搭建之MYSQL数据库"><a href="#LNMP环境搭建之MYSQL数据库" class="headerlink" title="LNMP环境搭建之MYSQL数据库"></a>LNMP环境搭建之MYSQL数据库</h2><p>数据库——大的文件夹———各种信息表格，存放在某一个文件夹中</p>
<p>数据表——excel表———用户信息表，客户信息表，，，</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">客户文件夹  ------数据库</span><br><span class="line">  用户电话表  -----数据表</span><br><span class="line">  用户住址表</span><br><span class="line"></span><br><span class="line">学生文件夹</span><br><span class="line">  学生信息表</span><br><span class="line">  学生成绩表</span><br></pre></td></tr></table></figure>



<h2 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">安装方式选择</span><br><span class="line">  yum,rpm包安装，简单，快速，无法定制化，新手推荐用yum</span><br><span class="line">二进制方式安装，把安装好后的mysq1打包成压缩文件，用户可以解压缩后直接简单配置即可使用，无须再安装，速度较快，</span><br><span class="line">适合专业的DBA使用</span><br><span class="line">源代码编译安装，定制化软件功能，安装过程复杂</span><br><span class="line"></span><br><span class="line">1.创建普通mysql用户，降低程序运行权限</span><br><span class="line">useradd -s /sbin/nologin mysql</span><br><span class="line"></span><br><span class="line">2.查看mysql用户信息</span><br><span class="line">[root@web02 mytools]# id mysql</span><br><span class="line">uid=27(mysql) gid=27(mysql) 组=27(mysql)</span><br><span class="line"></span><br><span class="line">3.下载mysql二进制代码包，注意提前下载好wget工具</span><br><span class="line">yum install wget -y</span><br><span class="line"></span><br><span class="line">4.下载mysq1二进制</span><br><span class="line">wget http://mirrors.163.com/mysql/Downloads/MySQL-5.7/mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line">备用</span><br><span class="line">http://mirrors.163.com/mysql/Downloads/MySQL-5.7/mysql-5.7.36-linux-glibc2.12-x86_64.tar.gz</span><br></pre></td></tr></table></figure>



<h2 id="二进制方式安装mysql"><a href="#二进制方式安装mysql" class="headerlink" title="二进制方式安装mysql"></a>二进制方式安装mysql</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1.解压缩二进制mysql代码</span><br><span class="line">[root@web02 mytools]# tar -zxvf mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line">2.配置软连接，快捷访问mysql</span><br><span class="line">ln -s /mytools/mysql-5.7.28-linux-glibc2.12-x86_64 /mytools/mysql</span><br><span class="line"></span><br><span class="line">3.安全性的准备工作，卸载可能centos7存在的mariadb相关的依赖关系</span><br><span class="line">rpm -e --nodeps mariadb-libs</span><br><span class="line"></span><br><span class="line">4.开始准备启动mysql的配置文件，[mysqld]是区，段的含义，以下的参数，对其生效</span><br><span class="line">[mysqld] 这是代表对服务端生效的参数</span><br><span class="line">[mysql] 这是代表对客户端的生效的参数</span><br><span class="line"></span><br><span class="line">cat &gt; /etc/my.cnf&lt;&lt;&#x27;EOF&#x27;</span><br><span class="line">[mysqld]</span><br><span class="line">basedir=/opt/mysql/</span><br><span class="line">datadir=/opt/mysql/data</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">server_id=l</span><br><span class="line">port=3306</span><br><span class="line">log_error=/opt/mysql/data/mysql_err.log</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>





<h2 id="初始化mysql服务端"><a href="#初始化mysql服务端" class="headerlink" title="初始化mysql服务端"></a>初始化mysql服务端</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.先卸载系统自带的mariadb的依赖</span><br><span class="line">rpm -e --nodeps mariadb-libs</span><br><span class="line"></span><br><span class="line">2.检查mysql的所需的依赖环境</span><br><span class="line">yum install libaio-devel -y</span><br><span class="line"></span><br><span class="line">3.创建mysql数据文件夹，用于初始化数据，且进行权限控制</span><br><span class="line">mkdir -p /mytools/mysql/data/</span><br><span class="line">chown -R mysql.mysql /mytools/mysql/  #修改mysql所有的内容,更改属主,属组为mysql用户</span><br><span class="line"></span><br><span class="line">4.初始化mysq1数据库</span><br><span class="line">/mytools/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/mytools/mysql/ --datadir=/mytools/mysql/data/</span><br></pre></td></tr></table></figure>



<h2 id="配置mysql客户端"><a href="#配置mysql客户端" class="headerlink" title="配置mysql客户端"></a>配置mysql客户端</h2><p>使用systemctl命令管理mysql数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.编写mysql启动的脚本,定义一个mysqld.service  #写入如下的内容</span><br><span class="line">cat &gt; /etc/systemd/system/mysqld.service&lt;&lt;&#x27;EOF&#x27;</span><br><span class="line">[Unit]</span><br><span class="line">Description=MySQL server by chaoge</span><br><span class="line">Documentation=man:mysqld(8)</span><br><span class="line">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span><br><span class="line">After=network.target</span><br><span class="line">After=syslog.target</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=mysql</span><br><span class="line">Group=mysql</span><br><span class="line">ExecStart=/opt/mysql/bin/mysqld --defaults-file=/etc/my.cnf</span><br><span class="line">LimitNOFILE=5000</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>



<h2 id="启动mysqld服务端"><a href="#启动mysqld服务端" class="headerlink" title="启动mysqld服务端"></a>启动mysqld服务端</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">由于我们配置了mysqld.service脚本，直接用命令启动用</span><br><span class="line"></span><br><span class="line">systemctl start mysqld.service</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动完了之后，检查数据库状态，检查为active状态，mysql就正常启动了</span></span><br><span class="line"></span><br><span class="line">[root@web02 system]# systemctl status mysqld</span><br><span class="line"></span><br><span class="line">检查进程</span><br><span class="line">ps -ef|grep mysqld</span><br><span class="line"></span><br><span class="line">检查端囗</span><br><span class="line">netstat -tunlp |grep 3306</span><br></pre></td></tr></table></figure>



<h2 id="登录mysql数据库"><a href="#登录mysql数据库" class="headerlink" title="登录mysql数据库"></a>登录mysql数据库</h2><p>这个mysql是c&#x2F;s架构模式的，就好比 登录qq一样</p>
<p>先启动mysqld服务端，然后用mysql客户端命令登录即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.如果你电脑之前装过其他的数据库，你可以用yum直接卸载，不会影响到你安装的二进制mysql数据库</span><br><span class="line">yum remove mysql -y</span><br><span class="line"></span><br><span class="line">2.退出会话，重新登录</span><br><span class="line"></span><br><span class="line">3.配置我们安装的二进制mysql PATH环境变量</span><br><span class="line"></span><br><span class="line">/mytools/mysql/bin  #这是我们安装的二进制mysql命令目录</span><br><span class="line">当前的PATH变量</span><br><span class="line"></span><br><span class="line">[root@web02 bin]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/mytools/nginx/sbin:/root/bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入如下新的PATH变量</span></span><br><span class="line">cat &gt; /etc/profile&lt;&lt;&#x27;EOF&#x27;</span><br><span class="line">PATH=&quot;$PATH:/mytools/mysql/bin:/mytools/nginx/sbin&quot;</span><br><span class="line">EOF</span><br><span class="line">保存退出之后，再次重新登录会话 或 source /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">看到如下提示，则正确配置了mysql环境变量</span></span><br><span class="line">[root@web02 ~]# which mysql</span><br><span class="line">/mytools/mysql/bin/mysql</span><br></pre></td></tr></table></figure>





<h2 id="登录mysql数据库，简单的使用mysql"><a href="#登录mysql数据库，简单的使用mysql" class="headerlink" title="登录mysql数据库，简单的使用mysql"></a>登录mysql数据库，简单的使用mysql</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录数据库的命令</span></span><br><span class="line">[root@web02 ~]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MysQL monitor. Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.28 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates.Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">mysql&gt;</span></span><br></pre></td></tr></table></figure>



<p>简单的sql语句查看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看当前所有的数据库SQL（数据库语句）</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建数据库</span></span><br><span class="line">chaoge</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create database chaoge;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再次查看数据库</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入chaoge数据库</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">use chaoge;</span></span><br><span class="line">Database changed</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">此时已经进入了mysql的chaoge数据库，我们可以在这个库中创建数据表</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show tables;  <span class="comment">#查看chaoge库中，是否有数据表</span></span></span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>



<p>修改mysql数据库密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -u root password &#x27;chaoge666&#x27;  #使用mysqladmin命令，修改root密码为chaoge666</span><br></pre></td></tr></table></figure>

<p>修改密码后再次想要登录数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@web02 ~]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line">ERROR 1045 (28000): Access denied for user &#x27;root&#x27;€&#x27;localhost&#x27; (using password: NO)</span><br><span class="line"></span><br><span class="line">如果你不输入密码，或者输入错误，就会有如上的提示</span><br></pre></td></tr></table></figure>

<p>正确的输入root密码chaoge666</p>
<h2 id="LNMP之PHP"><a href="#LNMP之PHP" class="headerlink" title="LNMP之PHP"></a>LNMP之PHP</h2><h3 id="FASTCGI"><a href="#FASTCGI" class="headerlink" title="FASTCGI"></a>FASTCGI</h3><p>cgi 通用网关接口，用于HTTP服务器(nginx,apache)和其他应用服务器（指的是另一个动态服务器上安装的python,php脚本编程语言编写的一个逻辑框架）通信的一个工具</p>
<p>fastcgi是一个可伸缩，高效的在HTTP服务器之间和动态脚本之间通信的网关接口</p>
<ul>
<li>在linux环境下,fastscgi其实就是一个socket套接字文件<ul>
<li>如果http服务器和后端程序运行在两台服务器上，这个fastcgi通信形式就是IP+端口的网络通信形式</li>
<li>如果http服务器和后端程序运行在同一台机器上，那么这个socket就可以是本地通信<ul>
<li>ip+port,127.0.0.1</li>
<li>socket套接字文件</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>多数主流的web服务器都是支持fastcgi网关接口，比如apache,nginx,lighttpd</p>
<p>fastcgi通用网关接口，也被多种脚本编程语言所支持，perl,php.python</p>
<p>当http服务器遇见静态请求，直接返回给用户</p>
<p>动态请求nginx就转发给fastcgi+php，后端程序进行逻辑处理完毕后，再返回给nginx，最终给用户响应</p>
<p>fastcgi_pass nginx通过该模块转发动态请求</p>
<h2 id="LNMP之PHP部署"><a href="#LNMP之PHP部署" class="headerlink" title="LNMP之PHP部署"></a>LNMP之PHP部署</h2><p>lnmp的部署</p>
<p>linux</p>
<p>nginx</p>
<p>mysql</p>
<p>php</p>
<p>部署流程笔记</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1.先检查好nginx和mysql的安装和启动</span><br><span class="line">ps -ef|grep nginx</span><br><span class="line">ps -ef|grep mysql</span><br><span class="line"></span><br><span class="line">2.来安装php所必须有的依赖环境</span><br><span class="line">yum install gcc gcc-c++ make zlib-devel libxml2-devel libjpeg-devel libjpeg-turbo-devel libiconv-devel freetype-devel libpng-devel gd-devel libcurl-devel libxslt-devel libxslt-devel -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.发现yum仓库默认缺少一个libiconv-devel软件包，因此我们可以手动下载，自行编译安装该</span><br><span class="line">wget http://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.15.tar.gz</span><br><span class="line"></span><br><span class="line">4.解压缩安装该软件包，编译三部曲</span><br><span class="line">tar -zxvf libiconv-1.15.tar.gz</span><br><span class="line">./configure --prefix=/mytools/libiconv</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">5.检查上述编译安装的命令是否正确结束了</span><br><span class="line">echo $?  #在执行上一条she11语句结束后，打印$?可以检查上一次的命令是否正确</span><br><span class="line">0</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="编译安装php程序"><a href="#编译安装php程序" class="headerlink" title="编译安装php程序"></a>编译安装php程序</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">1.下载php源代码</span><br><span class="line">wget http://mirrors.sohu.com/php/php-7.3.5.tar.gz</span><br><span class="line"></span><br><span class="line">2.解压缩php源代码，准备编译安装</span><br><span class="line">tar -zxvf php-7.3.5.tar.gz</span><br><span class="line">准备编译环境，指定安装路径，开启额外的功能等等</span><br><span class="line"></span><br><span class="line">./configure --prefix=/mytools/php7.3.5 \</span><br><span class="line">--enable-mysqlnd \</span><br><span class="line">--with-mysqli=mysqlnd \</span><br><span class="line">--with-pdo-mysql=mysqlnd \</span><br><span class="line">--with-iconv-dir=/mytools/libiconv \</span><br><span class="line">--with-freetype-dir \</span><br><span class="line">--with-jpeg-dir \</span><br><span class="line">--with-png-dir \</span><br><span class="line">--with-zlib \</span><br><span class="line">--with-libxml-dir=/usr \</span><br><span class="line">--enable-xml \</span><br><span class="line">--disable-rpath \</span><br><span class="line">--enable-bcmath \</span><br><span class="line">--enable-shmop \</span><br><span class="line">--enable-sysvsem \</span><br><span class="line">--enable-inline-optimization \</span><br><span class="line">--with-curl \</span><br><span class="line">--enable-mbregex \</span><br><span class="line">--enable-fpm \</span><br><span class="line">--enable-mbstring \</span><br><span class="line">--with-gd \</span><br><span class="line">--with-openssl \</span><br><span class="line">--with-mhash \</span><br><span class="line">--enable-pcntl \</span><br><span class="line">--enable-sockets \</span><br><span class="line">--with-xmlrpc \</span><br><span class="line">--enable-soap \</span><br><span class="line">--enable-short-tags \</span><br><span class="line">--enable-static \</span><br><span class="line">--with-xsl \</span><br><span class="line">--with-fpm-user=nginx \</span><br><span class="line">--with-fpm-group=nginx \</span><br><span class="line">--enable-ftp \</span><br><span class="line">--enable-opcache=no</span><br><span class="line"></span><br><span class="line">系统环境检查完毕后，准备开始编译且安装</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h2 id="PHP配置文件"><a href="#PHP配置文件" class="headerlink" title="PHP配置文件"></a>PHP配置文件</h2><p>默认的php配置文件模板，在解压php源码的目录下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@web02 php-7.3.5]#</span><br><span class="line">[root@web02 php-7.3.5]# pwd</span><br><span class="line">/mytools/php-7.3.5</span><br><span class="line">[root@web02 php-7.3.5]#</span><br><span class="line">[root@web02 php-7.3.5]# ls php.ini*</span><br><span class="line">php.ini-development php.ini-production</span><br><span class="line">[root@web02 php-7.3.5]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">比较一下php的生产配置文件，和开发模式配置文件的区别</span></span><br><span class="line">[root@web02 php-7.3.5]# vimdiff php.ini-development  php.ini-production</span><br><span class="line"></span><br><span class="line">2.拷贝该配置文件，放入到php的编译安装目录下</span><br><span class="line">[root@web02 php-7.3.5]# cp php.ini-development /mytools/php7.3.5/lib/php.ini</span><br></pre></td></tr></table></figure>

<h2 id="有关FASTCGI配置文件"><a href="#有关FASTCGI配置文件" class="headerlink" title="有关FASTCGI配置文件"></a>有关FASTCGI配置文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.检查fastcgi的默认配置文件</span><br><span class="line">[root@web02 etc]# pwd</span><br><span class="line">/mytools/php7.3.5/etc</span><br><span class="line">[root@web02 etc]# ls</span><br><span class="line">pear.conf php-fpm.conf.default php-fpm.d</span><br><span class="line"></span><br><span class="line">2.拷贝模板配置文件，生成新的php</span><br><span class="line">cp php-fpm.conf.default php-fpm.conf</span><br><span class="line">cd php-fpm.d</span><br><span class="line">cp www.conf.default www.conf</span><br><span class="line">[root@web02 etc]# ls</span><br><span class="line">pear.conf php-fpm.conf php-fpm.conf.default php-fpm.d</span><br></pre></td></tr></table></figure>



<h2 id="启动PHP服务，指定以fastcgi形式"><a href="#启动PHP服务，指定以fastcgi形式" class="headerlink" title="启动PHP服务，指定以fastcgi形式"></a>启动PHP服务，指定以fastcgi形式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">用绝对路径命令，启动php进程</span><br><span class="line">/mytools/php7.3.5/sbin/php-fpm</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动php后，检查端口和进程信息</span></span><br><span class="line">[root@web02 sbin]# netstat -tunlp |grep php</span><br><span class="line"></span><br><span class="line">[root@web02 sbin]# ps -ef|grep php</span><br></pre></td></tr></table></figure>



<h2 id="修改nginx支持php代码"><a href="#修改nginx支持php代码" class="headerlink" title="修改nginx支持php代码"></a>修改nginx支持php代码</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">1.注意这里的操作仅仅是学习阶段，为了让大家了解include语法的功能，对配置文件优化，进行的操作</span><br><span class="line"></span><br><span class="line">删除nginx.conf中其他无用的参数，然后用include语法，对每一个虚拟主机管理，进行配置文件拆封</span><br><span class="line"></span><br><span class="line">cat &gt; /mytools/nginx/conf/nginx.conf&lt;&lt;&#x27;EOF&#x27;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">user nobody;</span></span><br><span class="line">worker_processes  1;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">error_log logs/error.log;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">error_log logs/error.log notice;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">error_1og logs/error.log info;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">pid logs/nginx.pid;</span></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">    include  mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile  on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout 0;</span><br><span class="line">    keepalive_timeout 65;</span><br><span class="line"></span><br><span class="line">    #gzip on;</span><br><span class="line">    </span><br><span class="line">include extra/my_php.conf;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2.手动创建extra目录,以及my_php.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">写入如下内容</span></span><br><span class="line">cat &gt; /mytools/nginx/conf/extra/my_php.conf&lt;&lt;&#x27;EOF&#x27;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name _;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html;</span><br><span class="line">        index index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    #添加有关php程序的解析</span><br><span class="line">    #判断当请求url结尾是以php，php5的时候，就进入如下的location代码</span><br><span class="line">    location ~ .*\.(php|php5)?$ &#123;</span><br><span class="line">        root html/myphp;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        include fastcgi.conf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.检查nginx语法以及重启nginx</span><br><span class="line">[root@web02 extra]# nginx -t</span><br><span class="line">nginx: the configuration file /mytools/nginx116//conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /mytools/nginx116//conf/nginx.conf test is successful</span><br><span class="line">[root@web02 extra]#</span><br><span class="line">[root@web02 extra]#</span><br><span class="line">[root@web02 extra]# nginx -s reload</span><br><span class="line"></span><br><span class="line">4.创建php的首页脚本文件</span><br><span class="line">mkdir -p /mytools/nginx/html/myphp</span><br><span class="line"></span><br><span class="line">[root@web02 extra]# echo &quot;&lt;?php phpinfo();?&gt;&quot; &gt; /mytools/nginx/html/myphp/index.php</span><br><span class="line"></span><br><span class="line">5.测试lnmp的结合关系</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>

<p>当看到phpinfo的页面，表示lnmp环境搭建好了，nginx以及可以转发请求给php了</p>
<h2 id="测试php访问mysql"><a href="#测试php访问mysql" class="headerlink" title="测试php访问mysql"></a>测试php访问mysql</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@web02 myphp]# pwd</span><br><span class="line">/mytools/nginx/html/myphp</span><br><span class="line"></span><br><span class="line">[root@web02 myphp]# vim test_mysql.php</span><br><span class="line">&lt;?php</span><br><span class="line">$link_id=mysqli_connect(&#x27;localhost&#x27;,&#x27;root&#x27;,&#x27;chaoge666&#x27;) or mysql_error();</span><br><span class="line"></span><br><span class="line">if($link_id)&#123;</span><br><span class="line">  echo &quot;mysql successful by chaoge. \n&quot;;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">  echo mysql_error();</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">------</span><br><span class="line">如上脚本的中文解释</span><br><span class="line"></span><br><span class="line">1.建立mysql连接,把链接信息,复制给变量 link_id</span><br><span class="line">2.如果link_id为真，那么就打印一串字符串信息，告诉你mysql连接成功了</span><br><span class="line">3.否则给你输出mysq1的报错信息，让你能够自行的调试程序</span><br></pre></td></tr></table></figure>

<p>再次测试连接lnmp环境，让nginx转发请求给php然后测试是否能够连接mysql</p>
<h2 id="lnmp环境搭建wordpress"><a href="#lnmp环境搭建wordpress" class="headerlink" title="lnmp环境搭建wordpress"></a>lnmp环境搭建wordpress</h2><p>环境准备</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.启动mysql数据库，创建用于wordpress博客的数据库</span><br><span class="line"></span><br><span class="line">2.创建wordpress数据库</span><br><span class="line">create database wordpress;</span><br><span class="line"></span><br><span class="line">3.创建用于wordpress专用的数据库用户</span><br><span class="line">create user wordpress;</span><br><span class="line"></span><br><span class="line">4.给该用户授权</span><br><span class="line">#给wordpress用户授权，允许在localhost本地登录mysql，且有增删改查的权限，且设置密码123456</span><br><span class="line">grant all on wordpress.* to wordpresse@&#x27;localhost&#x27; identified by &#x27;123456&#x27;;</span><br><span class="line"></span><br><span class="line">5.刷新授权表</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">6.查询刚才创建的用户信息</span><br><span class="line">use mysql;  #进入mysql数据库</span><br><span class="line">show tables;  #查看所有的数据表</span><br><span class="line">desc user;  #查看user表的结构信息</span><br><span class="line">#查看mysql库中的user表，中的几个字段的信息</span><br><span class="line">select user,authentication_string,host from mysql.user;</span><br></pre></td></tr></table></figure>

<p>确保nginx支持php程序的解析</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name _;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root html/myphp;</span><br><span class="line">        index index.php index.html;</span><br><span class="line">    &#125;</span><br><span class="line">    #添加有关php程序的解析</span><br><span class="line">    #判断当请求url结尾是以php，php5的时候，就进入如下的location代码</span><br><span class="line">    location ~ .*\.(php|php5)?$ &#123;</span><br><span class="line">        fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">        fastcgi_index index.php;</span><br><span class="line">        include fastcgi.conf;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">重启nginx，加载新的配置</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>



<p>wordpress程序安装</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://mo-li001.github.io">壹拾陆</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mo-li001.github.io/posts/2b73bc61.html">https://mo-li001.github.io/posts/2b73bc61.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mo-li001.github.io" target="_blank">壹拾陆</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/posts/bb0dfe6.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">高可用服务</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/9f353bc9.html" title="Devops"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">Devops</div></div></a></div><div><a href="/posts/f5f9fa9b.html" title="Docker"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">Docker</div></div></a></div><div><a href="/posts/34d20e28.html" title="ELK"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">ELK</div></div></a></div><div><a href="/posts/8005.html" title="ELK快速部署"><img class="cover" src="https://tuchuangs.com/imgs/2022/09/18/074f3836d4f471b8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">ELK快速部署</div></div></a></div><div><a href="/posts/9bdc030a.html" title="HAproxy"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">HAproxy</div></div></a></div><div><a href="/posts/a71433d.html" title="Ansible"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">Ansible</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://images-1258700836.cos.ap-guangzhou.myqcloud.com/images/202209182232723.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">壹拾陆</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mo-li001/"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">个人笔记</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E8%B5%84%E6%BA%90%E6%B6%88%E8%80%97%E4%BD%8E-x2F-%E6%80%A7%E8%83%BD%E5%BC%BA"><span class="toc-text">Nginx资源消耗低&#x2F;性能强</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E6%88%90%E6%9C%AC%E4%BD%8E"><span class="toc-text">Nginx成本低</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">常见web服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#apache"><span class="toc-text">apache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lighttpd"><span class="toc-text">lighttpd</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tomcat"><span class="toc-text">tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IIS"><span class="toc-text">IIS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx"><span class="toc-text">Nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84"><span class="toc-text">技术架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E7%89%B9%E7%82%B9"><span class="toc-text">Nginx特点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%90%E6%9C%AC%E4%BD%8E"><span class="toc-text">成本低</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%A0%E5%A4%A7%E4%BC%98%E5%8A%BF"><span class="toc-text">几大优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0nginx%E7%9A%84%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B"><span class="toc-text">学习nginx的网络模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9CIO%E6%A8%A1%E5%9E%8B%E6%A6%82%E5%BF%B5"><span class="toc-text">网络IO模型概念</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E7%A9%BA%E9%97%B4%EF%BC%8C%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4"><span class="toc-text">内核空间，用户空间</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2"><span class="toc-text">进程切换</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E9%98%BB%E5%A1%9E"><span class="toc-text">进程阻塞</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-text">文件描述符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Linux-IO%E6%A8%A1%E5%9E%8B"><span class="toc-text">Linux IO模型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BD%95%E9%80%89%E6%8B%A9Nginx"><span class="toc-text">为何选择Nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B6%A3%E8%B0%88%E9%98%BB%E5%A1%9E%E6%A8%A1%E5%9E%8B%E4%B9%8B%EF%BC%88%E5%90%8C%E6%AD%A5%E9%98%BB%E5%A1%9EIO-block-IO%EF%BC%89"><span class="toc-text">趣谈阻塞模型之（同步阻塞IO block IO）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E9%9D%9E%E9%98%BB%E5%A1%9E"><span class="toc-text">同步非阻塞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="toc-text">IO多路复用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select%E4%BA%8B%E4%BB%B6"><span class="toc-text">select事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E9%9D%9E%E9%98%BB%E5%A1%9EIO%E6%A8%A1%E5%9E%8B"><span class="toc-text">异步非阻塞IO模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="toc-text">Nginx安装配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE-1"><span class="toc-text">Nginx安装配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E7%AC%94%E8%AE%B0"><span class="toc-text">nginx安装配置笔记</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85nginx"><span class="toc-text">编译安装nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%AD%E6%B3%95"><span class="toc-text">Nginx配置文件语法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx-conf%E6%8C%87%E4%BB%A4%E6%B3%A8%E9%87%8A"><span class="toc-text">nginx.conf指令注释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx-conf%E9%87%8D%E8%A6%81%E7%9A%84%E6%8C%87%E4%BB%A4%E5%9D%97"><span class="toc-text">nginx.conf重要的指令块</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E5%91%BD%E4%BB%A4%E8%A1%8C"><span class="toc-text">Nginx命令行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A1%88%E4%BE%8B"><span class="toc-text">nginx命令行案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E9%87%8D%E8%AF%BB"><span class="toc-text">配置文件重读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx-master%E4%BF%A1%E5%8F%B7%E4%BC%A0%E9%80%92"><span class="toc-text">nginx-master信号传递</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E7%83%AD%E9%83%A8%E7%BD%B2%E5%8A%9F%E8%83%BD"><span class="toc-text">nginx热部署功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E7%83%AD%E9%83%A8%E7%BD%B2%E6%93%8D%E4%BD%9C"><span class="toc-text">nginx热部署操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2"><span class="toc-text">Nginx日志切割</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="toc-text">nginx虚拟主机</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nginx%E5%8D%95%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text">nginx单虚拟主机的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nginx%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99%E7%9A%84%E6%90%AD%E5%BB%BA"><span class="toc-text">nginx静态网站的搭建</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8E%8B%E7%BC%A9"><span class="toc-text">Nginx静态资源压缩</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E5%9F%BA%E4%BA%8EIP%E7%9A%84%E5%A4%9A%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="toc-text">Nginx基于IP的多虚拟主机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E5%9F%BA%E4%BA%8E%E5%A4%9A%E5%9F%9F%E5%90%8D%E7%9A%84%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-text">Nginx基于多域名的虚拟主机配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E6%94%AF%E6%8C%81%E5%9F%BA%E4%BA%8E%E5%A4%9A%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-text">Nginx支持基于多端口的虚拟主机配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E8%AE%BF%E5%AE%A2%E6%97%A5%E5%BF%97"><span class="toc-text">Nginx访客日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E5%A4%9A%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E6%97%A5%E5%BF%97%E5%AE%9A%E4%B9%89"><span class="toc-text">Nginx多虚拟主机日志定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E7%9B%AE%E5%BD%95%E6%B5%8F%E8%A7%88%E5%8A%9F%E8%83%BD"><span class="toc-text">Nginx目录浏览功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E7%8A%B6%E6%80%81%E4%BF%A1%E6%81%AF%E5%8A%9F%E8%83%BD"><span class="toc-text">Nginx状态信息功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-text">Nginx错误日志</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-location%E5%8C%B9%E9%85%8D"><span class="toc-text">Nginx location匹配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E7%9A%84url%E5%9C%B0%E5%9D%80%E9%87%8D%E5%86%99%E5%8A%9F%E8%83%BD"><span class="toc-text">Nginx的url地址重写功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA301-URL%E8%B7%B3%E8%BD%AC"><span class="toc-text">实现一个301 URL跳转</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E8%AE%BF%E9%97%AE%E8%AE%A4%E8%AF%81"><span class="toc-text">Nginx访问认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LNMP%E6%9E%B6%E6%9E%84"><span class="toc-text">LNMP架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lnmp"><span class="toc-text">lnmp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LNMP%E7%BB%84%E5%90%88%E6%90%AD%E5%BB%BA"><span class="toc-text">LNMP组合搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LNMP%E9%83%A8%E7%BD%B2%E4%B9%8BNginx%E9%83%A8%E7%BD%B2"><span class="toc-text">LNMP部署之Nginx部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LNMP%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B9%8BMYSQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">LNMP环境搭建之MYSQL数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mysql"><span class="toc-text">安装mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85mysql"><span class="toc-text">二进制方式安装mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96mysql%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">初始化mysql服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEmysql%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">配置mysql客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8mysqld%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">启动mysqld服务端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95mysql%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">登录mysql数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95mysql%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%8C%E7%AE%80%E5%8D%95%E7%9A%84%E4%BD%BF%E7%94%A8mysql"><span class="toc-text">登录mysql数据库，简单的使用mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LNMP%E4%B9%8BPHP"><span class="toc-text">LNMP之PHP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FASTCGI"><span class="toc-text">FASTCGI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LNMP%E4%B9%8BPHP%E9%83%A8%E7%BD%B2"><span class="toc-text">LNMP之PHP部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85php%E7%A8%8B%E5%BA%8F"><span class="toc-text">编译安装php程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">PHP配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E5%85%B3FASTCGI%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">有关FASTCGI配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8PHP%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%8C%87%E5%AE%9A%E4%BB%A5fastcgi%E5%BD%A2%E5%BC%8F"><span class="toc-text">启动PHP服务，指定以fastcgi形式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9nginx%E6%94%AF%E6%8C%81php%E4%BB%A3%E7%A0%81"><span class="toc-text">修改nginx支持php代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95php%E8%AE%BF%E9%97%AEmysql"><span class="toc-text">测试php访问mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lnmp%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BAwordpress"><span class="toc-text">lnmp环境搭建wordpress</span></a></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/90f47a19.html" title="自动化装机">自动化装机</a><time datetime="2023-02-02T12:41:14.000Z" title="发表于 2023-02-02 20:41:14">2023-02-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/64202.html" title="linux">linux</a><time datetime="2023-02-02T12:41:14.000Z" title="发表于 2023-02-02 20:41:14">2023-02-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/8fb4d8df.html" title="zabbix">zabbix</a><time datetime="2023-02-02T01:43:57.000Z" title="发表于 2023-02-02 09:43:57">2023-02-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/8d6735b8.html" title="超经典SQL练习题，做完这些你的ＳＱＬ就过关了">超经典SQL练习题，做完这些你的ＳＱＬ就过关了</a><time datetime="2023-02-02T01:43:57.000Z" title="发表于 2023-02-02 09:43:57">2023-02-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/39d18a59.html" title="Mermaid绘图">Mermaid绘图</a><time datetime="2023-01-11T12:41:14.000Z" title="发表于 2023-01-11 20:41:14">2023-01-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 壹拾陆</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>