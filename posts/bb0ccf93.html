<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>nginx.conf配置文件详解 | 壹拾陆</title><meta name="keywords" content="Linux"><meta name="author" content="壹拾陆"><meta name="copyright" content="壹拾陆"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:type" content="article">
<meta property="og:title" content="nginx.conf配置文件详解">
<meta property="og:url" content="https://mo-li001.github.io/posts/bb0ccf93.html">
<meta property="og:site_name" content="壹拾陆">
<meta property="og:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-10-22T12:02:25.000Z">
<meta property="article:modified_time" content="2022-10-23T15:27:21.000Z">
<meta property="article:author" content="壹拾陆">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://mo-li001.github.io/posts/bb0ccf93"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'nginx.conf配置文件详解',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-23 23:27:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://images-1258700836.cos.ap-guangzhou.myqcloud.com/images/202209182232723.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">壹拾陆</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">nginx.conf配置文件详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-22T12:02:25.000Z" title="发表于 2022-10-22 20:02:25">2022-10-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-23T15:27:21.000Z" title="更新于 2022-10-23 23:27:21">2022-10-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BD%92%E6%A1%A3/">归档</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="nginx.conf配置文件详解"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">定义Nginx运行的用户和用户组</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">user nobady nobady;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx进程数，建议设置为等于CPU总核心数,默认为1。</span> </span><br><span class="line">worker_processes 8;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span> </span><br><span class="line">error_log /usr/local/nginx/logs/error.log info;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进程pid文件,指定nginx进程运行文件存放地址</span> </span><br><span class="line">pid /usr/local/nginx/logs/nginx.pid;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定进程可以打开的最大描述符：数目</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">工作模式与连接数上限</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这个指令是指当一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数 （<span class="built_in">ulimit</span> -n）与nginx进程数相除，但是nginx分配请求并不是那么均匀，所以最好与<span class="built_in">ulimit</span> -n 的值保持一致。</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">现在在linux 2.6内核下开启文件打开数为65535，worker_rlimit_nofile就相应应该填写 65535。</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这是因为nginx调度时分配请求到进程并不是那么的均衡，所以假如填写10240，总并发量达到3-4 万时就有进程可能超过10240了，这时会返回502错误。</span></span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events</span><br><span class="line">&#123;    </span><br><span class="line"></span><br><span class="line">    #参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型    </span><br><span class="line">    #是Linux 2.6以上版本内核中的高性能网络I/O模型，linux建议epoll，如果跑在FreeBSD 上面，就用kqueue模型。    </span><br><span class="line">    #补充说明：    </span><br><span class="line">    #与apache相类，nginx针对不同的操作系统，有不同的事件模型    </span><br><span class="line">    #A）标准事件模型    </span><br><span class="line">    #Select、poll属于标准事件模型，如果当前系统不存在更有效的方法，nginx会选择select 或poll </span><br><span class="line">    #B）高效事件模型    </span><br><span class="line">    #Kqueue：使用于FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 和 MacOS X.使用双处 理器的MacOS X系统使用kqueue可能会造成内核崩溃。    </span><br><span class="line">    #Epoll：使用于Linux内核2.6版本及以后的系统。    </span><br><span class="line">    #/dev/poll：使用于Solaris 7 11/99+，HP/UX 11.22+ (eventport)，IRIX 6.5.15+ 和 Tru64 UNIX 5.1A+。    </span><br><span class="line">    #Eventport：使用于Solaris 10。 为了防止出现内核崩溃的问题， 有必要安装安全补丁。</span><br><span class="line">    use epoll;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    #单个进程最大连接数（最大连接数=连接数*进程数）    </span><br><span class="line">    #根据硬件调整，和前面工作进程配合起来用，尽量大，但是别把cpu跑到100%就行。每个进程 允许的最多连接数，理论上每台nginx服务器的最大连接数为。</span><br><span class="line">    worker_connections 65535;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    #keepalive超时时间，默认是60s，切记这个参数也不能设置过大！否则会导致许多无效的 http连接占据着nginx的连接数，终nginx崩溃！    </span><br><span class="line">    keepalive_timeout 60;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    #客户端请求头部的缓冲区大小。这个可以根据你的系统分页大小来设置，一般一个请求头的大 小不会超过1k，不过由于一般系统分页都要大于1k，所以这里设置为分页大小。    </span><br><span class="line">    #分页大小可以用命令getconf PAGESIZE 取得。    </span><br><span class="line">    #[root@web001 ~]</span><br><span class="line">    # getconf PAGESIZE    </span><br><span class="line">    #4096    </span><br><span class="line">    #但也有client_header_buffer_size超过4k的情况，但是 client_header_buffer_size该值必须设置为“系统分页大小”的整倍数。    </span><br><span class="line">    client_header_buffer_size 4k;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    #这个将为打开文件指定缓存，默认是没有启用的，max指定缓存数量，建议和打开文件数一致， inactive是指经过多长时间文件没被请求后删除缓存。    </span><br><span class="line">    open_file_cache max=65535 inactive=60s;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    #这个是指多长时间检查一次缓存的有效信息。    </span><br><span class="line">    #语法:open_file_cache_valid time 默认值:open_file_cache_valid 60 使用字 段:http, server, location 这个指令指定了何时需要检查open_file_cache中缓存项目的有 效信息.</span><br><span class="line">    open_file_cache_valid 60s;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    #open_file_cache指令中的inactive参数时间内文件的最少使用次数，如果超过这个数字， 文件描述符一直是在缓存中打开的，如上例，如果有一个文件在inactive时间内一次没被使用，它将 被移除。</span><br><span class="line">    #语法:open_file_cache_min_uses number 默认值:open_file_cache_min_uses 1 使用字段:http, server, location  这个指令指定了在open_file_cache指令无效的参数中 一定的时间范围内可以使用的最小文件数,如果使用更大的值,文件描述符在cache中总是打开状态.</span><br><span class="line">    open_file_cache_min_uses 1;</span><br><span class="line">  </span><br><span class="line">    #语法:open_file_cache_errors on | off 默认值:open_file_cache_errors off 使用字段:http, server, location 这个指令指定是否在搜索一个文件是记录cache错误.</span><br><span class="line">    open_file_cache_errors on; </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设定http服务器，利用它的反向代理功能提供负载均衡支持</span> </span><br><span class="line">http</span><br><span class="line">&#123;    </span><br><span class="line">    #文件扩展名与文件类型映射表    </span><br><span class="line">    include mime.types;</span><br><span class="line">    </span><br><span class="line">    #默认文件类型 </span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line">    </span><br><span class="line">    #默认编码    </span><br><span class="line">    #charset utf-8;</span><br><span class="line">    </span><br><span class="line">    #服务器名字的hash表大小    </span><br><span class="line">    #保存服务器名字的hash表是由指令server_names_hash_max_size 和 server_names_hash_bucket_size所控制的。参数hash bucket size总是等于hash表的大 小，并且是一路处理器缓存大小的倍数。在减少了在内存中的存取次数后，使在处理器中加速查找 hash表键值成为可能。如果hash bucket size等于一路处理器缓存的大小，那么在查找键的时 候，最坏的情况下在内存中查找的次数为2。第一次是确定存储单元的地址，第二次是在存储单元中查 找键 值。因此，如果Nginx给出需要增大hash max size 或 hash bucket size的提示，那么 首要的是增大前一个参数的大小.    </span><br><span class="line">    server_names_hash_bucket_size 128;</span><br><span class="line">    </span><br><span class="line">    #客户端请求头部的缓冲区大小。这个可以根据你的系统分页大小来设置，一般一个请求的头部 大小不会超过1k，不过由于一般系统分页都要大于1k，所以这里设置为分页大小。分页大小可以用命 令getconf PAGESIZE取得。    </span><br><span class="line">    client_header_buffer_size 32k;</span><br><span class="line">    </span><br><span class="line">    #客户请求头缓冲大小。nginx默认会用client_header_buffer_size这个buffer来读取 header值，如果header过大，它会使用large_client_header_buffers来读取。</span><br><span class="line">    large_client_header_buffers 4 64k;</span><br><span class="line">    </span><br><span class="line">    #设定通过nginx上传文件的大小    </span><br><span class="line">    client_max_body_size 8m;</span><br><span class="line">    </span><br><span class="line">    #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于 普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络 I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。    </span><br><span class="line">    #sendfile指令指定 nginx 是否调用sendfile 函数（zero copy 方式）来输出文件，对 于普通应用，必须设为on。如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘 与网络IO处理速度，降低系统uptime。    </span><br><span class="line">    sendfile on;</span><br><span class="line">    </span><br><span class="line">    #开启目录列表访问，合适下载服务器，默认关闭。    </span><br><span class="line">    autoindex on;</span><br><span class="line"></span><br><span class="line">    #此选项允许或禁止使用socke的TCP_CORK的选项，此选项仅在使用sendfile的时候使用,告 诉nginx在一个数据包里发送所有头文件，而不一个接一个的发送。就是说数据包不会马上传送出 去，等到数据包最大时，一次性的传输出去，这样有助于解决网络堵塞    </span><br><span class="line">    tcp_nopush on;</span><br><span class="line"> </span><br><span class="line">    #告诉nginx不要缓存数据，而是一段一段的发送--当需要及时发送数据时，就应该给应用设置 这个属性，这样发送一小块数据信息时就不能立即得到返回值    </span><br><span class="line">    tcp_nodelay on;</span><br><span class="line">    </span><br><span class="line">    #长连接超时时间，单位是秒    </span><br><span class="line">    keepalive_timeout 120;</span><br><span class="line">    </span><br><span class="line">    #FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意 思都能理解。    </span><br><span class="line">    #这个指令为FastCGI缓存指定一个路径，目录结构等级，关键字区域存储时间和非活动删除时 间    </span><br><span class="line">    fastcgi_cache_path /usr/local/nginx/fastcgi_cache levels=1:2 keys_zone=TEST:10m inactive=5m;    </span><br><span class="line">    #指定连接到后端FastCGI的超时时间    </span><br><span class="line">    fastcgi_connect_timeout 300;    </span><br><span class="line">    #向FastCGI传送请求的超时时间，这个值是指已经完成两次握手后向FastCGI传送请求的超时时间</span><br><span class="line">    fastcgi_send_timeout 300;    </span><br><span class="line">    #接收FastCGI应答的超时时间，这个值是指已经完成两次握手后接收FastCGI应答的超时时间</span><br><span class="line">    fastcgi_read_timeout 300;    </span><br><span class="line">    #指定读取FastCGI应答第一部分 需要用多大的缓冲区,这里可以设置为fastcgi_buffers指 令指定的缓冲区大小，上面的指令指定它将使用1个 16k的缓冲区去读取应答的第一部分，即应答 头，其实这个应答头一般情况下都很小（不会超过1k），但是你如果在fastcgi_buffers指令中指 定了缓冲区的大小，那么它也会分配一个fastcgi_buffers指定的缓冲区大小去缓存</span><br><span class="line">    fastcgi_buffer_size 64k;    </span><br><span class="line">    #指定本地需要用多少和多大的缓冲区来 缓冲FastCGI的应答，如上所示，如果一个php脚本所 产生的页面大小为256k，则会为其分配16个16k的缓冲区来缓存，如果大于256k，增大 于256k的部 分会缓存到fastcgi_temp指定的路径中， 当然这对服务器负载来说是不明智的方案，因为内存中处 理数据速度要快于硬盘，通常这个值 的设置应该选择一个你的站点中的php脚本所产生的页面大小的 中间值，比如你的站点大部分脚本所产生的页面大小为 256k就可以把这个值设置为16 16k，或者4 64k 或者64 4k，但很显然，后两种并不是好的设置方法，因为如果产生的页面只有32k，如果用4 64k它会分配1个64k的缓冲区去缓存，而如果使用64 4k它会分配8个4k的缓冲区去缓存，而如果使 用16 16k则它会分配2个16k去缓存页面，这样看起来似乎更加合理•</span><br><span class="line">    fastcgi_buffers 4 64k;    </span><br><span class="line">    #这个指令我也不知道是做什么用，只知道默认值是fastcgi_buffers的两倍    </span><br><span class="line">    fastcgi_busy_buffers_size 128k;    </span><br><span class="line">    #在写入fastcgi_temp_path时将用多大的数据块，默认值是fastcgi_buffers的两倍    </span><br><span class="line">    fastcgi_temp_file_write_size 128k;    </span><br><span class="line">    #开启FastCGI缓存并且为其制定一个名称。个人感觉开启缓存非常有用，可以有效降低CPU负 载，并且防止502错误。但是这个缓存会引起很多问题，因为它缓存的是动态页面。具体使用还需根据 自己的需求 </span><br><span class="line">    fastcgi_cache TEST    </span><br><span class="line">    #为指定的应答代码指定缓存时间，如上例中将200，302应答缓存一小时，301应答缓存1天， 其他为1分钟</span><br><span class="line">    fastcgi_cache_valid 200 302 1h;</span><br><span class="line">    fastcgi_cache_valid 301 1d;</span><br><span class="line">    fastcgi_cache_valid any 1m; </span><br><span class="line">    </span><br><span class="line">    #缓存在fastcgi_cache_path指令inactive参数值时间内的最少使用次数，如上例，如果在 5分钟内某文件1次也没有被使用，那么这个文件将被移除</span><br><span class="line">    fastcgi_cache_min_uses 1;</span><br><span class="line">    </span><br><span class="line">    #gzip模块设置    </span><br><span class="line">    #开启压缩</span><br><span class="line">    gzip  on;       </span><br><span class="line">    # 设置允许压缩的页面最小字节数，页面字节数从header头得content-length中进行获取。 默认值是0，不管页面多大都压缩。建议设置成大于2k的字节数，小于2k可能会越压越大。  </span><br><span class="line"> 	gzip_min_length 2k;      </span><br><span class="line">    # 设置系统获取几个单位的缓存用于存储gzip的压缩结果数据流。 例如 4 4k 代表以4k为单 位，按照原始数据大小以4k为单位的4倍申请内存。 4 8k 代表以8k为单位，按照原始数据大小以8k 为单位的4倍申请内存。      </span><br><span class="line">    # 如果没有设置，默认值是申请跟原始数据相同大小的内存空间去存储gzip压缩结果。      </span><br><span class="line">    gzip_buffers 4 16k;      </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩级别，1-10，数字越大压缩的越好，也越占用CPU时间</span></span><br><span class="line">    gzip_comp_level 5;      </span><br><span class="line">    # 默认值: gzip_types text/html (默认不对js/css文件进行压缩)      </span><br><span class="line">    # 压缩类型，匹配MIME类型进行压缩      </span><br><span class="line">    # 不能用通配符 text/*      </span><br><span class="line">    # (无论是否指定)text/html默认已经压缩       </span><br><span class="line">    # 设置哪压缩种文本文件可参考 conf/mime.types      </span><br><span class="line">    gzip_types text/plain application/xjavascript text/css application/xml;     </span><br><span class="line">    # 值为1.0和1.1 代表是否压缩http协议1.0，选择1.0则1.0和1.1都可以压缩      </span><br><span class="line">    gzip_http_version 1.0       </span><br><span class="line">    # IE6及以下禁止压缩</span><br><span class="line">    gzip_disable &quot;MSIE [1-6]\.&quot;;       </span><br><span class="line">    # 默认值：off      </span><br><span class="line">    # Nginx作为反向代理的时候启用，开启或者关闭后端服务器返回的结果，匹配的前提是后端服 务器必须要返回包含&quot;Via&quot;的 header头。      </span><br><span class="line">    # off - 关闭所有的代理结果数据的压缩      </span><br><span class="line">    # expired - 启用压缩，如果header头中包含 &quot;Expires&quot; 头信息      </span><br><span class="line">    # no-cache - 启用压缩，如果header头中包含 &quot;Cache-Control:no-cache&quot; 头信息     </span><br><span class="line">    # no-store - 启用压缩，如果header头中包含 &quot;Cache-Control:no-store&quot; 头信息     </span><br><span class="line">    # private - 启用压缩，如果header头中包含 &quot;Cache-Control:private&quot; 头信息      </span><br><span class="line">    # no_last_modified - 启用压缩,如果header头中不包含 &quot;Last-Modified&quot; 头信息     </span><br><span class="line">    # no_etag - 启用压缩 ,如果header头中不包含 &quot;ETag&quot; 头信息      </span><br><span class="line">    # auth - 启用压缩 , 如果header头中包含 &quot;Authorization&quot; 头信息      </span><br><span class="line">    # any - 无条件启用压缩</span><br><span class="line">    gzip_proxied expired no-cache no-store private auth;      </span><br><span class="line">    # 给CDN和代理服务器使用，针对相同url，可以根据头信息返回压缩和非压缩副本      </span><br><span class="line">    gzip_vary on; </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    #开启限制IP连接数的时候需要使用    </span><br><span class="line">    #limit_zone crawler $binary_remote_addr 10m;</span><br><span class="line">    </span><br><span class="line">    #负载均衡配置</span><br><span class="line">    upstream www.xx.com &#123;             </span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示 权值，权值越高被分配到的几率越大。</span></span><br><span class="line">        server 192.168.80.121:80 weight=3;</span><br><span class="line">        server 192.168.80.122:80 weight=2;</span><br><span class="line">        server 192.168.80.123:80 weight=3;</span><br><span class="line">        </span><br><span class="line">        #nginx的upstream目前支持4种方式的分配</span><br><span class="line">        #1、轮询（默认）</span><br><span class="line">        #每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。</span><br><span class="line">        #2、weight</span><br><span class="line">        #指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</span><br><span class="line">        #例如：</span><br><span class="line">        #upstream bakend &#123;        </span><br><span class="line">        #    server 192.168.0.14 weight=10;</span><br><span class="line">        #    server 192.168.0.15 weight=10;</span><br><span class="line">        #&#125;        </span><br><span class="line">        #2、ip_hash</span><br><span class="line">        #每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决 session的问题。        </span><br><span class="line">        #例如：        </span><br><span class="line">        #upstream bakend &#123;        </span><br><span class="line">        #    ip_hash;        </span><br><span class="line">        #    server 192.168.0.14:88;        </span><br><span class="line">        #    server 192.168.0.15:80;        </span><br><span class="line">        #&#125;        </span><br><span class="line">        #3、fair（第三方）        </span><br><span class="line">        #按后端服务器的响应时间来分配请求，响应时间短的优先分配。        </span><br><span class="line">        #upstream backend &#123;        </span><br><span class="line">        #    server server1;        </span><br><span class="line">        #    server server2;        </span><br><span class="line">        #    fair;        </span><br><span class="line">        #&#125;        </span><br><span class="line">        #4、url_hash（第三方）        </span><br><span class="line">        #按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为 缓存时比较有效。        </span><br><span class="line">        #例：在upstream中加入hash语句，server语句中不能写入weight等其他的参数， hash_method是使用的hash算法        </span><br><span class="line">        #upstream backend &#123;        </span><br><span class="line">        #    server squid1:3128;        </span><br><span class="line">        #    server squid2:3128;        </span><br><span class="line">        #    hash $request_uri;        </span><br><span class="line">        #    hash_method crc32;        </span><br><span class="line">        #&#125;</span><br><span class="line"></span><br><span class="line">        #tips:        </span><br><span class="line">        #upstream bakend&#123;</span><br><span class="line">        #定义负载均衡设备的Ip及设备状态&#125;&#123;        </span><br><span class="line">        #    ip_hash;        </span><br><span class="line">        #    server 127.0.0.1:9090 down;        </span><br><span class="line">        #    server 127.0.0.1:8080 weight=2;        </span><br><span class="line">        #    server 127.0.0.1:6060;        </span><br><span class="line">        #    server 127.0.0.1:7070 backup;        </span><br><span class="line">        #&#125;        </span><br><span class="line">        #在需要使用负载均衡的server中增加 proxy_pass http://bakend/;</span><br><span class="line">        </span><br><span class="line">        #每个设备的状态设置为:        </span><br><span class="line">        #1.down表示单前的server暂时不参与负载        </span><br><span class="line">        #2.weight为weight越大，负载的权重就越大。        </span><br><span class="line">        #3.max_fails：允许请求失败的次数默认为1.当超过最大次数时，返回 proxy_next_upstream模块定义的错误        </span><br><span class="line">        #4.fail_timeout:max_fails次失败后，暂停的时间。        </span><br><span class="line">        #5.backup： 其它所有的非backup机器down或者忙的时候，请求backup机器。所以这 台机器压力会最轻。</span><br><span class="line">        #nginx支持同时设置多组的负载均衡，用来给不用的server来使用。        </span><br><span class="line">        #client_body_in_file_only设置为On 可以讲client post过来的数据记录到文件 中用来做debug        </span><br><span class="line">        #client_body_temp_path设置记录文件的目录 可以设置最多3层目录        </span><br><span class="line">        #location对URL进行匹配.可以进行重定向或者进行新的代理 负载均衡</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line"><span class="meta prompt_">	#</span><span class="language-bash">虚拟主机的配置</span>    </span><br><span class="line">    server</span><br><span class="line">    &#123;        </span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">监听端口</span></span><br><span class="line">        listen 80;</span><br><span class="line">        </span><br><span class="line">        #域名可以有多个，用空格隔开</span><br><span class="line">        server_name www.xx.com xx.com;</span><br><span class="line">        index index.html index.htm index.php; </span><br><span class="line">        root /data/www/xx;</span><br><span class="line">        </span><br><span class="line">        #对******进行负载均衡</span><br><span class="line">        location ~ .*.(php|php5)?$</span><br><span class="line">        &#123;</span><br><span class="line">            fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">            fastcgi_index index.php; </span><br><span class="line">            include fastcgi.conf;</span><br><span class="line">        &#125;                 </span><br><span class="line">        #图片缓存时间设置</span><br><span class="line">        location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 10d;</span><br><span class="line">        &#125;                 </span><br><span class="line"><span class="meta prompt_">		#</span><span class="language-bash">JS和CSS缓存时间设置</span></span><br><span class="line">        location ~ .*.(js|css)?$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 1h;</span><br><span class="line">        &#125;                 </span><br><span class="line">        #日志格式设定        </span><br><span class="line">        #$remote_addr与$http_x_forwarded_for用以记录客户端的ip地址；        </span><br><span class="line">        #$remote_user：用来记录客户端用户名称；        </span><br><span class="line">        #$time_local： 用来记录访问时间与时区；        </span><br><span class="line">        #$request： 用来记录请求的url与http协议；        </span><br><span class="line">        #$status： 用来记录请求状态；成功是200，        </span><br><span class="line">        #$body_bytes_sent ：记录发送给客户端文件主体内容大小；        </span><br><span class="line">        #$http_referer：用来记录从那个页面链接访问过来的；        </span><br><span class="line">        #$http_user_agent：记录客户浏览器的相关信息；        </span><br><span class="line">        #通常web服务器放在反向代理的后面，这样就不能获取到客户的IP地址了，通过$remote_add拿到的IP地址是反向代理服务器的iP地址。        </span><br><span class="line">        #反向代理服务器在转发请求的http头信息中，可以增加x_forwarded_for信息，用以记 录原有客户端的IP地址和原来客户端的请求的服务器地址。</span><br><span class="line">        log_format access &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">        &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">        &#x27;&quot;$http_user_agent&quot; $http_x_forwarded_for&#x27;;                 </span><br><span class="line">        #定义本虚拟主机的访问日志</span><br><span class="line">        access_log  /usr/local/nginx/logs/host.access.log  main;</span><br><span class="line">        access_log  /usr/local/nginx/logs/host.access.404.log  log404;                 </span><br><span class="line">        #对 &quot;/&quot; 启用反向代理</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:88;</span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;                         </span><br><span class="line">            #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            </span><br><span class="line">            #以下是一些反向代理的配置，可选。</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            </span><br><span class="line">            #允许客户端请求的最大单文件字节数</span><br><span class="line">            client_max_body_size 10m;</span><br><span class="line">            </span><br><span class="line">            #缓冲区代理缓冲用户端请求的最大字节数，            </span><br><span class="line">            #如果把它设置为比较大的数值，例如256k，那么，无论使用firefox还是IE浏览 器，来提交任意小于256k的图片，都很正常。如果注释该指令，使用默认的 client_body_buffer_size设置，也就是操作系统页面大小的两倍，8k或者16k，问题就出现了。            </span><br><span class="line">            #无论使用firefox4.0还是IE8.0，提交一个比较大，200k左右的图片，都返回 500 Internal Server Error错误</span><br><span class="line">            client_body_buffer_size 128k;</span><br><span class="line">            </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">表示使nginx阻止HTTP应答代码为400或者更高的应答。</span></span><br><span class="line">            proxy_intercept_errors on;</span><br><span class="line">            </span><br><span class="line">            #后端服务器连接的超时时间_发起握手等候响应超时时间            </span><br><span class="line">            #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">            proxy_connect_timeout 90;</span><br><span class="line">            </span><br><span class="line">            #后端服务器数据回传时间(代理发送超时)            </span><br><span class="line">            #后端服务器数据回传时间_就是在规定时间之内后端服务器必须传完所有的数据</span><br><span class="line">            proxy_send_timeout 90;</span><br><span class="line">            </span><br><span class="line">            #连接成功后，后端服务器响应时间(代理接收超时)            </span><br><span class="line">            #连接成功后_等候后端服务器响应时间_其实已经进入后端的排队之中等候处理（也 可以说是后端服务器处理请求的时间）</span><br><span class="line">            proxy_read_timeout 90;</span><br><span class="line">            </span><br><span class="line">            #设置代理服务器（nginx）保存用户头信息的缓冲区大小            </span><br><span class="line">            #设置从被代理服务器读取的第一部分应答的缓冲区大小，通常情况下这部分应答中包 含一个小的应答头，默认情况下这个值的大小为指令proxy_buffers中指定的一个缓冲区的大小，不 过可以将其设置为更小</span><br><span class="line">            proxy_buffer_size 4k;</span><br><span class="line">            </span><br><span class="line">            #proxy_buffers缓冲区，网页平均在32k以下的设置            </span><br><span class="line">            #设置用于读取应答（来自被代理服务器）的缓冲区数目和大小，默认情况也为分页大 小，根据操作系统的不同可能是4k或者8k</span><br><span class="line">            proxy_buffers 4 32k;</span><br><span class="line">            </span><br><span class="line">            #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">            proxy_busy_buffers_size 64k;</span><br><span class="line">            </span><br><span class="line">            #设置在写入proxy_temp_path时数据的大小，预防一个工作进程在传递文件时阻塞太长 </span><br><span class="line">            #设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br><span class="line">            proxy_temp_file_write_size 64k;</span><br><span class="line">        &#125;                          </span><br><span class="line">        #设定查看Nginx状态的地址</span><br><span class="line">        location /NginxStatus &#123;</span><br><span class="line">            stub_status on;</span><br><span class="line">            access_log on;</span><br><span class="line">            auth_basic &quot;NginxStatus&quot;;</span><br><span class="line">            auth_basic_user_file confpasswd;            </span><br><span class="line"><span class="meta prompt_">			#</span><span class="language-bash">htpasswd文件的内容可以用apache提供的htpasswd工具来产生。</span></span><br><span class="line">        &#125;                 </span><br><span class="line">        #本地动静分离反向代理配置        </span><br><span class="line">        #所有jsp的页面均交由tomcat或resin处理</span><br><span class="line">        location ~ .(jsp|jspx|do)?$ &#123;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http://127.0.0.1:8080; </span><br><span class="line">        &#125;                 </span><br><span class="line">        #所有静态文件由nginx直接读取不经过tomcat或resin</span><br><span class="line">        location ~ .*. (htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|        pdf|xls|mp3|wma)$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 15d;</span><br><span class="line">        &#125;</span><br><span class="line">        location ~ .*.(js|css)?$</span><br><span class="line">        &#123;</span><br><span class="line">            expires 1h;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h1 id="一、Nginx-conf-文件配置结构"><a href="#一、Nginx-conf-文件配置结构" class="headerlink" title="一、Nginx.conf 文件配置结构"></a>一、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Nginx&spm=1001.2101.3001.7020">Nginx</a>.conf 文件配置结构</h1><hr>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">...              	# 全局块</span><br><span class="line"></span><br><span class="line">events &#123;         	# events块</span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;							# http块</span><br><span class="line">    ...   						# http全局块</span><br><span class="line">    server &#123; 					# server块</span><br><span class="line">        ...       				# server全局块</span><br><span class="line">        location [PATTERN] &#123; 	# location块</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        location [PATTERN] &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123; </span><br><span class="line">        ...      </span><br><span class="line">    &#125;</span><br><span class="line">    ...				# http全局块</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>全局块：</strong> 配置影响 <em>nginx</em> 全局的指令。一般有运行 <em>nginx</em> 服务器的用户组、<em>nginx</em> 进程 <em>pid</em> 存放路径、日志存放路径、配置文件引入、允许生成 <em>worker process</em> 数等；</li>
<li><strong>Events 块：</strong> 配置影响 <em>nginx</em> 服务器或与用户的网络连接。有每个进程的最大连接数、选取哪种事件驱动模型处理连接请求、是否允许同时接受多个网路连接、开启多个网络连接序列化等；</li>
<li><strong>Http 块：</strong> 可以嵌套多个 <em>server_、配置代理、缓存、日志定义等绝大多数功能和第三方模块的配置。如文件引入、_mime-type</em> 定义、日志自定义、是否使用 <em>sendfile</em> 传输文件、连接超时时间、单连接请求数等；</li>
<li><strong>Server 块：</strong> 配置虚拟主机的相关参数，一个 <em>http</em> 中可以有多个 _server_；</li>
<li><strong>Location 块：</strong> 配置请求的路由，以及各种页面的处理情况。</li>
</ul>
<p><strong>注意</strong>：<em>Nginx</em> 配置的注释是以 <code>#</code> 开头，并且每条语句都要以 <code>;</code> 结束，除了语句块 <code>&#123;&#125;</code>。</p>
<h1 id="二、配置详解"><a href="#二、配置详解" class="headerlink" title="二、配置详解"></a>二、配置详解</h1><hr>
<h3 id="1、全局块"><a href="#1、全局块" class="headerlink" title="1、全局块"></a>1、全局块</h3><p>所有在 <em>nginx.conf</em> 内但不在任何 <em>{ }</em> 中的指令都属于全局块的指令：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 用户组</span><br><span class="line">user myUsr myGroup;</span><br><span class="line"></span><br><span class="line"># 工作进程数</span><br><span class="line">worker_processes  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"># 进程文件路径</span><br><span class="line">pid /user/<span class="keyword">local</span>/nginx/nginx.pid;</span><br><span class="line"></span><br><span class="line"># 日志路径和日志级别</span><br><span class="line">error_log logs/<span class="built_in">error</span>.<span class="built_in">log</span> <span class="built_in">debug</span>;</span><br></pre></td></tr></table></figure>

<p>指令详解：</p>
<ul>
<li>用户或用户组默认为 nobody；</li>
<li>工作进程数可以设置为CPU的核心数；</li>
<li>日志级别有：<code>debug|info|notice|warn|error|crit|alert|emerg</code></li>
</ul>
<p><strong>注意</strong>：<em>Nginx</em> 配置中，以 <code>/</code> 开头的路径表示绝对路径，不以 <code>/</code> 开头的路径表示相对路径，相对路径的根目录为 <em>Nginx</em> 的根目录。</p>
<h3 id="2、Events-块"><a href="#2、Events-块" class="headerlink" title="2、Events 块"></a>2、Events 块</h3><p>所有写在 <code>events&#123;&#125;</code> 中的指令都属于 <em>Events</em> 块指令：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">	# 设置网路连接序列化</span><br><span class="line">	accept_mutex on;</span><br><span class="line">	</span><br><span class="line">	# 一个进程是否同时接受多个网络连接</span><br><span class="line">	multi_accept on;</span><br><span class="line">	</span><br><span class="line">	# 事件驱动模型</span><br><span class="line">	use epoll;</span><br><span class="line">	</span><br><span class="line">	# 最大连接数</span><br><span class="line">	worker_connections  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指令详解：</p>
<ul>
<li>设置网路连接序列化是为了防止惊群现象发生，默认为 _on_；</li>
<li>是否同时接受多个网络连接指令默认值为 _off_；</li>
<li>事件驱动模型的可选项有：<code>select|poll|kqueue|epoll|resig|/dev/poll|eventport</code>。</li>
</ul>
<h3 id="3、HTTP-全局块"><a href="#3、HTTP-全局块" class="headerlink" title="3、HTTP 全局块"></a>3、HTTP 全局块</h3><p>所有写在 <code>http&#123;&#125;</code> 块中，但不写在 <em>http{ }</em> 内的子模块中的所有指定就是 <em>HTTP</em> 全局块，会影响 <em>http{ }</em> 及其子模块的内容：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">	# 文件扩展名与文件类型映射表</span><br><span class="line">	include mime.types;</span><br><span class="line">	</span><br><span class="line">	# 默认文件类型</span><br><span class="line">	default_type  application/octet-stream;</span><br><span class="line">	</span><br><span class="line">	# 是否开启服务日志</span><br><span class="line">	access_log off;</span><br><span class="line">	</span><br><span class="line">	# 自定义服务日志格式</span><br><span class="line">	log_format myLogFormat <span class="string">&#x27;$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">	# 设置日志的格式</span><br><span class="line">	access_log <span class="built_in">log</span>/access.<span class="built_in">log</span> myLogFormat;</span><br><span class="line">	</span><br><span class="line">	# 是否开启高效文件传输模式</span><br><span class="line">	sendfile on;</span><br><span class="line">	</span><br><span class="line">	# 每个进程每次最大传输值</span><br><span class="line">	sendfile_max_chunk <span class="number">100</span>k;</span><br><span class="line">	</span><br><span class="line">	# 长连接超时时间</span><br><span class="line">	keeplive_timeout <span class="number">100</span>;</span><br><span class="line">	</span><br><span class="line">	# 响应客户端的超时时间</span><br><span class="line">	send_timeout <span class="number">75</span>;</span><br><span class="line">	</span><br><span class="line">	# 客户端请求头的区缓冲区大小</span><br><span class="line">	client_header_buffer_size <span class="number">32</span>k;</span><br><span class="line">	</span><br><span class="line">	# 客户端请求头的最大缓冲区数量和大小</span><br><span class="line">	large_client_header_buffers <span class="number">8</span> <span class="number">32</span>k;</span><br><span class="line">	</span><br><span class="line">	# 允许客户端请求的最大字节数</span><br><span class="line">	client_max_body_size  <span class="number">10</span>m;</span><br><span class="line">	</span><br><span class="line">	# 客户端请求体的缓冲区大小</span><br><span class="line">	client_body_buffer_size  <span class="number">128</span>k;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指令详解：</p>
<ul>
<li>文件扩展名与文件类型映射表在 <code>nginx/conf</code> 下；</li>
<li>默认文件类型的默认值为 <code>text/plain</code>；</li>
<li>是否开启服务日志的默认值为 _on_，开启了之后需要配置 <code>access_log</code> 路径；</li>
<li>自定义日志格式的更多变量请参考：【Nginx】之常用内置变量</li>
<li><code>sendfile</code> 指令指定 <em>nginx</em> 是否调用 <em>sendfile</em> 函数来输出文件，减少用户空间到内核空间的上下文切换；对于普通应用设为 _on_，如果用来进行下载等应用磁盘 <em>IO</em> 重负载应用，可设置为 _off_，以平衡磁盘与网络 <em>I&#x2F;O</em> 处理速度，降低系统的负载；</li>
<li><code>sendfile_max_chunk</code> 指令的默认为 0，表示不设上限；</li>
<li><code>keeplive_timeout</code> 指令的单位是秒，这个参数很敏感，涉及浏览器的种类、后端服务器的超时设置、操作系统的设置；长连接在请求大量小文件的时候，可以减少重建连接的开销；但如果上传大文件时在设置的超时时间内没上传完成会导致失败，如果设置时间过长，用户又多，长时间保持连接会占用大量资源；</li>
<li><code>send_timeout</code> 指令仅限于两个连接活动之间的时间，如果超过这个时间，客户端没有任何活动，Nginx将会关闭连接；</li>
<li>使用 <code>client_header_buffer_size</code> 指令时，为避免请求 header 过大出现 400 错误，可以适当设置大一点；</li>
<li>使用 <code>large_client_header_buffers</code> 指令时，为避免请求 header 过大出现 400 错误，可以适当设置大一点。</li>
</ul>
<p>除了这些常用的 <em>http</em> 配置外，还用一些特定的 <em>http</em> 配置，比如<strong>反向代理</strong>配置：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    ...</span><br><span class="line">    # 配置 https_proxy 反向代理</span><br><span class="line">    proxy_connect_timeout  <span class="number">75</span>;</span><br><span class="line">    proxy_read_timeout  <span class="number">75</span>;</span><br><span class="line">    proxy_send_timeout <span class="number">100</span>;</span><br><span class="line">    proxy_buffer_size  <span class="number">4</span>k;</span><br><span class="line">    proxy_buffers  <span class="number">4</span>  <span class="number">32</span>k;</span><br><span class="line">    proxy_busy_buffers_size  <span class="number">64</span>k;</span><br><span class="line">    proxy_max_temp_file_size  <span class="number">64</span>k;</span><br><span class="line">    proxy_temp_file_write_size <span class="number">64</span>k;</span><br><span class="line">    proxy_temp_path  proxy_temp;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>http_proxy</strong> 模块指令详解：</p>
<ul>
<li><code>proxy_connect_timeout</code> ：表示 <em>Nginx</em> 跟代理服务器连接超时时间；</li>
<li><code>proxy_read_timeout</code> ：表示 <em>Nginx</em> 与代理服务器两个成功的响应操作之间超时时间；</li>
<li><code>proxy_send_timeout</code> ：表示 <em>Nginx</em> 传输文件至代理服务器的超时时间；</li>
<li><code>proxy_buffer_size</code> ：用于设置从代理服务器读取并保存用户头信息的缓冲区大小；</li>
<li><code>proxy_buffers</code> ：设置代理缓冲区大小，<em>Nginx</em> 针对单个连接，缓存来自代理服务器的响应，网页平均在32k以下的话，可以设置为 <em>4 32K</em> ；</li>
<li><code>proxy_busy_buffers_size</code> ：设置高负荷下的缓冲大小，一般为 <em>proxy_buffers</em> 的两倍；</li>
<li><code>proxy_max_temp_file_size</code> ：的用途介绍：当 <em>proxy_buffers</em> 放不下后端服务器的响应内容时，会将一部分保存到硬盘的临时文件中，这个值用来设置最大临时文件大小，默认1024M，它与 <em>proxy_cache</em> 没有关系；大于这个值，将从 <em>upstream</em> 服务器传回，设置为 <strong>0</strong> 禁用；</li>
<li><code>proxy_temp_file_write_size</code> ：当缓存被代理的服务器响应到临时文件时，这个选项限制每次写临时文件的大小；</li>
<li><code>proxy_temp_path</code> ：用于指定临时文件所在的目录。</li>
</ul>
<p>以及 <strong>http_gzip</strong> 模块配置：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    ...</span><br><span class="line">    # 配置 http_gzip 模块</span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length <span class="number">1</span>K;</span><br><span class="line">    gzip_buffers  <span class="number">4</span>  <span class="number">16</span>k;</span><br><span class="line">    gzip_http_version <span class="number">1.0</span>;</span><br><span class="line">    gzip_comp_level <span class="number">6</span>;</span><br><span class="line">    gzip_types text/plain text/css application/json;</span><br><span class="line">    gzip_proxied any;</span><br><span class="line">    gzip_vray on;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>http_gzip</strong> 配置详解：</p>
<ul>
<li><code>gzip</code> ：如果设置为 <em>on</em> 则表示开启 <em>gzip</em> 压缩输出，可减少网络传输；</li>
<li><code>gzip_min_length</code> ：设置允许压缩的页面最小字节数（_到达这个大小才进行压缩_），页面字节数从 <em>header</em> 头的 <em>content-length</em> 中进行获取。默认值是 20。建议设置成大于 1k 的字节数，小于 1k 可能会越压越大；</li>
<li><code>gzip_buffers</code> ：设置系统获取多少个单位的缓存用于存储 <em>gzip</em> 的压缩结果数据流，<em>4 16k</em> 表示按照原始数据大小以 16k 为单位的 4 倍进行内存申请；</li>
<li><code>gzip_http_version</code> ：设置 <em>http</em> 协议的版本，早期的浏览器不支持 <em>Gzip</em> 压缩，用户就会看到乱码，所以为了支持前期版本加上了这个选项；如果你用了 <em>Nginx</em> 的反向代理并启用 <em>Gzip</em> 压缩的话就需要加上，而由于末端通信是 _http&#x2F;1.0_，故请设置为 1.0；</li>
<li><code>gzip_comp_level</code> ：<em>zip</em> 压缩比，为 1 时，压缩比最小处理速度最快；为 9 时，压缩比最大但处理速度最慢；</li>
<li><code>gzip_types</code> ：匹配 <em>mime</em> 类型进行压缩，无论是否指定，<code>text/html</code> 类型总是会被压缩的；</li>
<li><code>gzip_proxied</code> ：置开启或者关闭后端服务器返回的结果是否压缩，<em>Nginx</em> 作为反向代理的时候启用，匹配的前提是后端服务器必须要返回包含 <code>Via</code> 的 header头；</li>
<li><code>gzip_vray</code> ： 该配置和 <em>http</em> 头有关系，会在响应头加个 <code>Vary: Accept-Encoding</code> ，可以让前端的缓存服务器缓存经过 <em>gzip</em> 压缩的页面，例如：用 Squid 缓存经过 Nginx 压缩的数据。</li>
</ul>
<p>负载均衡后台服务器列表：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">	server <span class="number">192.168</span><span class="number">.56</span><span class="number">.10</span>:<span class="number">8080</span> max_fails=<span class="number">2</span> fail_timeout=<span class="number">30</span>s backup; # 热备</span><br><span class="line">	server <span class="number">192.168</span><span class="number">.56</span><span class="number">.11</span>:<span class="number">8080</span> max_fails=<span class="number">2</span> fail_timeout=<span class="number">30</span>s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、Server-块"><a href="#4、Server-块" class="headerlink" title="4、Server 块"></a>4、Server 块</h3><p>所有位于 <code>server&#123;&#125;</code> 模块中的指令都属于 <em>Server</em> 块指令：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    # 监听端口</span><br><span class="line">    listen <span class="number">8080</span>;</span><br><span class="line">    </span><br><span class="line">    # 监听服务器地址</span><br><span class="line">    server_name <span class="number">192.168</span><span class="number">.56</span><span class="number">.10</span>;</span><br><span class="line">    </span><br><span class="line">    # 每个连接请求上限次数</span><br><span class="line">    keepalive_requests <span class="number">120</span>;</span><br><span class="line">    </span><br><span class="line">    # 字符集</span><br><span class="line">    charset utf<span class="number">-8</span>;</span><br><span class="line">    </span><br><span class="line">    # 服务日志所在目录以及日志格式</span><br><span class="line">    access_log logs/host80.<span class="built_in">log</span> myLogFormat;</span><br><span class="line">    </span><br><span class="line">    # 错误页</span><br><span class="line">    error_page  <span class="number">404</span>  /<span class="number">404.</span>html;</span><br><span class="line">	error_page  <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指令详解：</p>
<ul>
<li>监听的端口，默认80，小于1024的要以root启动；</li>
<li>监听的服务器地址可以是 IP 或者域名，并且可以使用正则表达式进行匹配；</li>
<li>日志格式的定义和 <em>http</em> 模块的定义方式相同；</li>
<li>错误页的地址为：<code>server_name + error_page</code>。</li>
</ul>
<p>除了以上常用的 <em>Server</em> 块指令外还有其他特殊的指令，比如 <code>ssl</code> 模块，在请求方式中，如果使用 <em>https</em> 进行请求的话是需要证书，这时就要对 <em>https</em> 请求设置 _ssl_：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	# 开启 ssl</span><br><span class="line">	ssl on;</span><br><span class="line">	</span><br><span class="line">	# ssl 证书路径</span><br><span class="line">	ssl_certificate /opt/ssl/nginx.crt;</span><br><span class="line">	</span><br><span class="line">	# ssl 证书秘钥</span><br><span class="line">	ssl_certificate_key /opt/ssl/nginx.key;</span><br><span class="line">	</span><br><span class="line">	# ssl 会话超时时间</span><br><span class="line">	ssl_session_timeout <span class="number">1</span>d;</span><br><span class="line">	</span><br><span class="line">	# ssl 缓存</span><br><span class="line">	ssl_session_cache shared:SSL:<span class="number">50</span>m;</span><br><span class="line">	</span><br><span class="line">	# ssl 会话票据</span><br><span class="line">	ssl_session_tickets off;</span><br><span class="line">	</span><br><span class="line">	# ssl 协议版本</span><br><span class="line">	ssl_protocols TLSv1<span class="number">.2</span>;</span><br><span class="line">	</span><br><span class="line">	# ssl 密码套件</span><br><span class="line">	ssl_ciphers  <span class="string">&#x27;HIGH:!aNULL:!MD5&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">	# 开启 ssl 服务密码套件</span><br><span class="line">	ssl_prefer_server_ciphers on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、Location-块"><a href="#5、Location-块" class="headerlink" title="5、Location 块"></a>5、Location 块</h3><p>常用 <em>location</em> 指令：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">location  ~*  ^.+$ &#123;</span><br><span class="line">	# 服务器的默认网站根目录位置</span><br><span class="line">    root /var/www/html;</span><br><span class="line">    </span><br><span class="line">    # 默认访问的文件名</span><br><span class="line">    index  index.html index.htm index.jsp;</span><br><span class="line"></span><br><span class="line">	# 拒绝的 IP</span><br><span class="line">	deny <span class="number">192.168</span><span class="number">.56</span><span class="number">.21</span>;</span><br><span class="line">	deny all;</span><br><span class="line"></span><br><span class="line">	# 允许的 IP </span><br><span class="line">	allow <span class="number">192.168</span><span class="number">.56</span><span class="number">.10</span>;</span><br><span class="line">	allow all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指令详解：</p>
<ul>
<li>紧跟在 <em>location</em> 后面的是 <em>location</em> 模块监听的 <em>url</em> 地址，也就是 <em>location</em> 块的匹配规则，只有匹配正确的地址才会进入该 location 块，可以使用正则表达式进行匹配（<code>~</code>表示区分大小写，<code>~*</code> 表示不区分大小写）；</li>
<li><code>root</code> ：定义服务器的默认网站根目录位置，如果 <em>LocationURL</em> 匹配的是子目录或文件，<em>root</em> 指令没什么作用，一般放在 <em>server</em> 指令里面或 <em>LocationURL</em> 为 <code>/</code> 的 <em>location</em> 块下；</li>
<li><code>index</code> ：定义该 <em>location</em> 路径下默认访问的文件名，一般跟 <em>root</em> 的路径放在一起。</li>
</ul>
<p><strong>设置响应头</strong>（可用于<strong>访问控制</strong>和处理跨域问题）：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">location &#123;</span><br><span class="line">    # 设置允许跨域类型</span><br><span class="line">    add_header Access-Control-Allow-Origin * always;</span><br><span class="line">    </span><br><span class="line">    # 是否允许信任证书</span><br><span class="line">    add_header Access-Control-Allow-Credentials <span class="string">&#x27;true&#x27;</span> always;</span><br><span class="line">    </span><br><span class="line">    # 允许的请求头类型</span><br><span class="line">    add_header Access-Control-Allow-Headers * always;</span><br><span class="line">    </span><br><span class="line">    # 设置允许的请求方式</span><br><span class="line">    add_header Access-Control-Allow-Methods <span class="string">&#x27;PUT, GET, POST, DELETE, OPTIONS&#x27;</span> always;</span><br><span class="line">    </span><br><span class="line">    # 处理 OPTIONS 请求</span><br><span class="line">    <span class="keyword">if</span> ($request_method = <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">204</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指令详解：</p>
<ul>
<li>为了避免出现失效问题，一般在都在最后面添加 <code>always</code> ；</li>
<li>允许的请求头类型包括：<em>Origin、X-Requested-With、content-Type、Accept、Authorization、uuid</em> 等</li>
</ul>
<p><strong>设置反向代理服务器：</strong></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location &#123;</span><br><span class="line">    # 反向代理服务器地址</span><br><span class="line">    proxy_pass  http://<span class="number">192.168</span><span class="number">.56</span><span class="number">.33</span>;</span><br><span class="line">        </span><br><span class="line">    # 是否重定向代理服务器地址</span><br><span class="line">    proxy_redirect off;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>设置向代理服务器发送请求时的请求头数据：</strong></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">location &#123;</span><br><span class="line">    # cookie</span><br><span class="line">    proxy_pass_header  Set-Cookie;</span><br><span class="line">    # 主机名</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    # 真实 IP</span><br><span class="line">    proxy_set_header X-Real-Ip $remote_addr;</span><br><span class="line">    # 表示 HTTP 请求端真实 IP</span><br><span class="line">    proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>PS：更多关于 Nginx 配置文档可以参考 Nginx 官方文档</strong>：<a target="_blank" rel="noopener" href="http://nginx.org/en/docs/">http://nginx.org/en/docs/</a></p>
<h1 id="三、Nginx-配置实例"><a href="#三、Nginx-配置实例" class="headerlink" title="三、Nginx 配置实例"></a>三、Nginx 配置实例</h1><hr>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">工作进程数</span></span><br><span class="line">worker_processes  1;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">日志文件路径</span></span><br><span class="line">error_log  logs/error.log;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进程运行文件路径</span></span><br><span class="line">pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">使用 epoll 事件驱动</span></span><br><span class="line">	use epoll;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">最大连接数</span></span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">文件类型设置</span></span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # 日志格式</span><br><span class="line">    log_format  mainFromat  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    # 服务日志</span><br><span class="line">    access_log  logs/access.log  mainFromat;</span><br><span class="line"></span><br><span class="line">    # 开启高效文件传输模式</span><br><span class="line">    sendfile        on;</span><br><span class="line"></span><br><span class="line">    # 配置 tcp 发送模式</span><br><span class="line">    tcp_nopush     on;</span><br><span class="line">    tcp_nodelay on;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">	# </span><span class="language-bash">长连接超时时间</span></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    # 请求头</span><br><span class="line">    client_header_buffer_size 32k;</span><br><span class="line">    large_client_header_buffers 4 32k;</span><br><span class="line"></span><br><span class="line">    # 请求体</span><br><span class="line">    client_body_buffer_size  128k;</span><br><span class="line">    client_max_body_size  10m;</span><br><span class="line"></span><br><span class="line">    # 设置 gzip</span><br><span class="line">    gzip  on;</span><br><span class="line">    gzip_disable &quot;msie6&quot;;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    gzip_proxied any;</span><br><span class="line">    gzip_comp_level 6;</span><br><span class="line">    gzip_buffers 16 8k;</span><br><span class="line">    gzip_http_version 1.1;</span><br><span class="line">    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span><br><span class="line"></span><br><span class="line">    # 代理服务器相关设置</span><br><span class="line">    proxy_connect_timeout  75;</span><br><span class="line">    proxy_read_timeout  75;</span><br><span class="line">    proxy_send_timeout  100;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 监听http服务</span><br><span class="line">    server &#123;</span><br><span class="line"></span><br><span class="line">    	# 服务器端口地址</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  192.168.56.10;</span><br><span class="line"></span><br><span class="line">        # 字符集</span><br><span class="line">        charset utf-8;</span><br><span class="line"></span><br><span class="line">        # 服务日志路径</span><br><span class="line">        access_log  logs/host.access.log  mainFromat;</span><br><span class="line"></span><br><span class="line">        # 地址定位模块</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm index.jsp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /demo &#123;</span><br><span class="line">        	# 添加反向代理服务器</span><br><span class="line">        	proxy_pass  http://192.168.56.10:8080;</span><br><span class="line">        	proxy_redirect off;</span><br><span class="line">			proxy_pass_header  Set-Cookie;</span><br><span class="line">			proxy_set_header Host $host;</span><br><span class="line">			proxy_set_header X-Real-Ip $remote_addr;</span><br><span class="line">			proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">添加请求头</span></span><br><span class="line">			add_header Access-Control-Allow-Origin * always;</span><br><span class="line">			add_header Access-Control-Allow-Credentials &#x27;true&#x27; always;</span><br><span class="line">			add_header Access-Control-Allow-Methods &#x27;PUT, GET, POST, DELETE, OPTIONS&#x27; always;</span><br><span class="line">			add_header Access-Control-Allow-Headers * always;</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">			# </span><span class="language-bash">处理 OPTION 请求</span></span><br><span class="line">			if ($request_method = &#x27;OPTIONS&#x27;) &#123;</span><br><span class="line">				return 204;</span><br><span class="line">			&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        # 重定向错误页到静态页</span><br><span class="line">        error_page   404              /404.html;</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 监听https服务</span><br><span class="line">    server &#123;</span><br><span class="line">        listen       443   ssl;</span><br><span class="line">        server_name  192.168.56.10;</span><br><span class="line"></span><br><span class="line">        # ssl 设置</span><br><span class="line">    	ssl_certificate /opt/ssl/nginx.crt;</span><br><span class="line">    	ssl_certificate_key /opt/ssl/nginx.key;</span><br><span class="line">    	ssl_session_timeout 1d;</span><br><span class="line">    	ssl_session_cache shared:SSL:50m;</span><br><span class="line">    	ssl_session_tickets off;</span><br><span class="line">    	ssl_protocols TLSv1.2;</span><br><span class="line">        ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">        ssl_prefer_server_ciphers  on;</span><br><span class="line">        ssl_stapling on;</span><br><span class="line">        ssl_stapling_verify on;</span><br><span class="line"></span><br><span class="line">       location / &#123;</span><br><span class="line">           root   html;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 监听其他端口服务</span><br><span class="line">    server &#123;</span><br><span class="line">       listen       8081;</span><br><span class="line">       server_name  localhost;</span><br><span class="line"></span><br><span class="line">       location / &#123;</span><br><span class="line">           root   html;</span><br><span class="line">           index  index.html index.htm;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">定义Nginx运行的用户和用户组</span></span><br><span class="line">user www www;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nginx进程数，建议设置为等于CPU总核心数。</span></span><br><span class="line">worker_processes 8;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span></span><br><span class="line">error_log /var/log/nginx/error.log info;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进程文件</span></span><br><span class="line">pid /var/run/nginx.pid;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值<span class="built_in">ulimit</span> -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与<span class="built_in">ulimit</span> -n的值保持一致。</span></span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">工作模式与连接数上限</span></span><br><span class="line">events</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。</span></span><br><span class="line">use epoll;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">单个进程最大连接数（最大连接数=连接数*进程数）</span></span><br><span class="line">worker_connections 65535;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设定http服务器</span></span><br><span class="line">http</span><br><span class="line">&#123;</span><br><span class="line">include mime.types; #文件扩展名与文件类型映射表</span><br><span class="line">default_type application/octet-stream; #默认文件类型</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">charset utf-8; <span class="comment">#默认编码</span></span></span><br><span class="line">server_names_hash_bucket_size 128; #服务器名字的hash表大小</span><br><span class="line">client_header_buffer_size 32k; #上传文件大小限制</span><br><span class="line">large_client_header_buffers 4 64k; #设定请求缓</span><br><span class="line">client_max_body_size 8m; #设定请求缓</span><br><span class="line">sendfile on; #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</span><br><span class="line">autoindex on; #开启目录列表访问，合适下载服务器，默认关闭。</span><br><span class="line">tcp_nopush on; #防止网络阻塞</span><br><span class="line">tcp_nodelay on; #防止网络阻塞</span><br><span class="line">keepalive_timeout 120; #长连接超时时间，单位是秒</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。</span></span><br><span class="line">fastcgi_connect_timeout 300;</span><br><span class="line">fastcgi_send_timeout 300;</span><br><span class="line">fastcgi_read_timeout 300;</span><br><span class="line">fastcgi_buffer_size 64k;</span><br><span class="line">fastcgi_buffers 4 64k;</span><br><span class="line">fastcgi_busy_buffers_size 128k;</span><br><span class="line">fastcgi_temp_file_write_size 128k;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">gzip模块设置</span></span><br><span class="line">gzip on; #开启gzip压缩输出</span><br><span class="line">gzip_min_length 1k; #最小压缩文件大小</span><br><span class="line">gzip_buffers 4 16k; #压缩缓冲区</span><br><span class="line">gzip_http_version 1.0; #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</span><br><span class="line">gzip_comp_level 2; #压缩等级</span><br><span class="line">gzip_types text/plain application/x-javascript text/css application/xml;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</span></span><br><span class="line">gzip_vary on;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">limit_zone crawler <span class="variable">$binary_remote_addr</span> 10m; <span class="comment">#开启限制IP连接数的时候需要使用</span></span></span><br><span class="line">upstream blog.ha97.com &#123;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。</span></span><br><span class="line">server 192.168.80.121:80 weight=3;</span><br><span class="line">server 192.168.80.122:80 weight=2;</span><br><span class="line">server 192.168.80.123:80 weight=3;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">虚拟主机的配置</span></span><br><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">监听端口</span></span><br><span class="line">listen 80;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">域名可以有多个，用空格隔开</span></span><br><span class="line">server_name www.ha97.com ha97.com;</span><br><span class="line">index index.html index.htm index.php;</span><br><span class="line">root /data/www/ha97;</span><br><span class="line">location ~ .*.(php|php5)?$</span><br><span class="line">&#123;</span><br><span class="line">fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">include fastcgi.conf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">图片缓存时间设置</span></span><br><span class="line">location ~ .*.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">&#123;</span><br><span class="line">expires 10d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">JS和CSS缓存时间设置</span></span><br><span class="line">location ~ .*.(js|css)?$</span><br><span class="line">&#123;</span><br><span class="line">expires 1h;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">日志格式设定</span></span><br><span class="line">log_format access &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">&#x27;&quot;$http_user_agent&quot; $http_x_forwarded_for&#x27;;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">定义本虚拟主机的访问日志</span></span><br><span class="line">access_log /var/log/nginx/ha97access.log access;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">对 <span class="string">&quot;/&quot;</span> 启用反向代理</span></span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass http://127.0.0.1:88;</span><br><span class="line">proxy_redirect off;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span></span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">以下是一些反向代理的配置，可选。</span></span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">client_max_body_size 10m; #允许客户端请求的最大单文件字节数</span><br><span class="line">client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数，</span><br><span class="line">proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">proxy_send_timeout 90; #后端服务器数据回传时间(代理发送超时)</span><br><span class="line">proxy_read_timeout 90; #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line">proxy_buffer_size 4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line">proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的设置</span><br><span class="line">proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">proxy_temp_file_write_size 64k;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设定缓存文件夹大小，大于这个值，将从upstream服务器传</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设定查看Nginx状态的地址</span></span><br><span class="line">location /NginxStatus &#123;</span><br><span class="line">stub_status on;</span><br><span class="line">access_log on;</span><br><span class="line">auth_basic &quot;NginxStatus&quot;;</span><br><span class="line">auth_basic_user_file conf/htpasswd;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">htpasswd文件的内容可以用apache提供的htpasswd工具来产生。</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">本地动静分离反向代理配置</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">所有jsp的页面均交由tomcat或resin处理</span></span><br><span class="line">location ~ .(jsp|jspx|do)?$ &#123;</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">proxy_pass http://127.0.0.1:8080;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">所有静态文件由nginx直接读取不经过tomcat或resin</span></span><br><span class="line">location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$</span><br><span class="line">&#123; expires 15d; &#125;</span><br><span class="line">location ~ .*.(js|css)?$</span><br><span class="line">&#123; expires 1h; &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line">#定义Nginx运行的用户和用户组</span><br><span class="line">user www www;</span><br><span class="line"></span><br><span class="line">#nginx进程数，建议设置为等于CPU总核心数。</span><br><span class="line">worker_processes 8;</span><br><span class="line"></span><br><span class="line">#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span><br><span class="line">error_log /var/log/nginx/error.log info;</span><br><span class="line"></span><br><span class="line">#进程文件</span><br><span class="line">pid /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">#一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。</span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line">#工作模式与连接数上限</span><br><span class="line">events</span><br><span class="line">&#123;</span><br><span class="line">#参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型，如果跑在FreeBSD上面，就用kqueue模型。</span><br><span class="line">use epoll;</span><br><span class="line">#单个进程最大连接数（最大连接数=连接数*进程数）</span><br><span class="line">worker_connections 65535;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#设定http服务器</span><br><span class="line">http</span><br><span class="line">&#123;</span><br><span class="line">include mime.types; #文件扩展名与文件类型映射表</span><br><span class="line">default_type application/octet-stream; #默认文件类型</span><br><span class="line">#charset utf-8; #默认编码</span><br><span class="line">server_names_hash_bucket_size 128; #服务器名字的hash表大小</span><br><span class="line">client_header_buffer_size 32k; #上传文件大小限制</span><br><span class="line">large_client_header_buffers 4 64k; #设定请求缓</span><br><span class="line">client_max_body_size 8m; #设定请求缓</span><br><span class="line">sendfile on; #开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</span><br><span class="line">autoindex on; #开启目录列表访问，合适下载服务器，默认关闭。</span><br><span class="line">tcp_nopush on; #防止网络阻塞</span><br><span class="line">tcp_nodelay on; #防止网络阻塞</span><br><span class="line">keepalive_timeout 120; #长连接超时时间，单位是秒</span><br><span class="line"></span><br><span class="line">#FastCGI相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。</span><br><span class="line">fastcgi_connect_timeout 300;</span><br><span class="line">fastcgi_send_timeout 300;</span><br><span class="line">fastcgi_read_timeout 300;</span><br><span class="line">fastcgi_buffer_size 64k;</span><br><span class="line">fastcgi_buffers 4 64k;</span><br><span class="line">fastcgi_busy_buffers_size 128k;</span><br><span class="line">fastcgi_temp_file_write_size 128k;</span><br><span class="line"></span><br><span class="line">#gzip模块设置</span><br><span class="line">gzip on; #开启gzip压缩输出</span><br><span class="line">gzip_min_length 1k; #最小压缩文件大小</span><br><span class="line">gzip_buffers 4 16k; #压缩缓冲区</span><br><span class="line">gzip_http_version 1.0; #压缩版本（默认1.1，前端如果是squid2.5请使用1.0）</span><br><span class="line">gzip_comp_level 2; #压缩等级</span><br><span class="line">gzip_types text/plain application/x-javascript text/css application/xml;</span><br><span class="line">#压缩类型，默认就已经包含text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个warn。</span><br><span class="line">gzip_vary on;</span><br><span class="line">#limit_zone crawler $binary_remote_addr 10m; #开启限制IP连接数的时候需要使用</span><br><span class="line"></span><br><span class="line">upstream blog.ha97.com &#123;</span><br><span class="line">#upstream的负载均衡，weight是权重，可以根据机器配置定义权重。weigth参数表示权值，权值越高被分配到的几率越大。</span><br><span class="line">server 192.168.80.121:80 weight=3;</span><br><span class="line">server 192.168.80.122:80 weight=2;</span><br><span class="line">server 192.168.80.123:80 weight=3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#虚拟主机的配置</span><br><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">  #监听端口</span><br><span class="line">  listen 80;</span><br><span class="line">  #域名可以有多个，用空格隔开</span><br><span class="line">  server_name www.ha97.com ha97.com;</span><br><span class="line">  index index.html index.htm index.php;</span><br><span class="line">  root /data/www/ha97;</span><br><span class="line">  location ~ .*\.(php|php5)?$</span><br><span class="line">  &#123;</span><br><span class="line">  fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">  fastcgi_index index.php;</span><br><span class="line">  include fastcgi.conf;</span><br><span class="line">  &#125;</span><br><span class="line">  #图片缓存时间设置</span><br><span class="line">  location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">  &#123;</span><br><span class="line">  expires 10d;</span><br><span class="line">  &#125;</span><br><span class="line">  #JS和CSS缓存时间设置</span><br><span class="line">  location ~ .*\.(js|css)?$</span><br><span class="line">  &#123;</span><br><span class="line">  expires 1h;</span><br><span class="line">  &#125;</span><br><span class="line">  #日志格式设定</span><br><span class="line">  log_format access &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">  &#x27;&quot;$http_user_agent&quot; $http_x_forwarded_for&#x27;;</span><br><span class="line">  #定义本虚拟主机的访问日志</span><br><span class="line">  access_log /var/log/nginx/ha97access.log access;</span><br><span class="line"></span><br><span class="line">  #对 &quot;/&quot; 启用反向代理</span><br><span class="line">  location / &#123;</span><br><span class="line">  proxy_pass http://127.0.0.1:88;</span><br><span class="line">  proxy_redirect off;</span><br><span class="line">  proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">  #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  #以下是一些反向代理的配置，可选。</span><br><span class="line">  proxy_set_header Host $host;</span><br><span class="line">  client_max_body_size 10m; #允许客户端请求的最大单文件字节数</span><br><span class="line">  client_body_buffer_size 128k; #缓冲区代理缓冲用户端请求的最大字节数，</span><br><span class="line">  proxy_connect_timeout 90; #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">  proxy_send_timeout 90; #后端服务器数据回传时间(代理发送超时)</span><br><span class="line">  proxy_read_timeout 90; #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line">  proxy_buffer_size 4k; #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line">  proxy_buffers 4 32k; #proxy_buffers缓冲区，网页平均在32k以下的设置</span><br><span class="line">  proxy_busy_buffers_size 64k; #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">  proxy_temp_file_write_size 64k;</span><br><span class="line">  #设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  #设定查看Nginx状态的地址</span><br><span class="line">  location /NginxStatus &#123;</span><br><span class="line">  stub_status on;</span><br><span class="line">  access_log on;</span><br><span class="line">  auth_basic &quot;NginxStatus&quot;;</span><br><span class="line">  auth_basic_user_file conf/htpasswd;</span><br><span class="line">  #htpasswd文件的内容可以用apache提供的htpasswd工具来产生。</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  #本地动静分离反向代理配置</span><br><span class="line">  #所有jsp的页面均交由tomcat或resin处理</span><br><span class="line">  location ~ .(jsp|jspx|do)?$ &#123;</span><br><span class="line">  proxy_set_header Host $host;</span><br><span class="line">  proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">  proxy_pass http://127.0.0.1:8080;</span><br><span class="line">  &#125;</span><br><span class="line">  #所有静态文件由nginx直接读取不经过tomcat或resin</span><br><span class="line">  location ~ .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$</span><br><span class="line">  &#123; expires 15d; &#125;</span><br><span class="line">  location ~ .*.(js|css)?$</span><br><span class="line">  &#123; expires 1h; &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://mo-li001.github.io">壹拾陆</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mo-li001.github.io/posts/bb0ccf93.html">https://mo-li001.github.io/posts/bb0ccf93.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mo-li001.github.io" target="_blank">壹拾陆</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/180b7b06.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">trtd文件压缩及解压缩命令（4个）tdtd</div></div></a></div><div class="next-post pull-right"><a href="/posts/9240bb8c.html"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">tomcat</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/9f353bc9.html" title="Devops"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">Devops</div></div></a></div><div><a href="/posts/f5f9fa9b.html" title="Docker"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">Docker</div></div></a></div><div><a href="/posts/34d20e28.html" title="ELK"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">ELK</div></div></a></div><div><a href="/posts/8005.html" title="ELK快速部署"><img class="cover" src="https://tuchuangs.com/imgs/2022/09/18/074f3836d4f471b8.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">ELK快速部署</div></div></a></div><div><a href="/posts/9bdc030a.html" title="HAproxy"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">HAproxy</div></div></a></div><div><a href="/posts/a71433d.html" title="Ansible"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-31</div><div class="title">Ansible</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://images-1258700836.cos.ap-guangzhou.myqcloud.com/images/202209182232723.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">壹拾陆</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mo-li001/"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">个人笔记</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Nginx-conf-%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%84"><span class="toc-text">一、Nginx.conf 文件配置结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="toc-text">二、配置详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%85%A8%E5%B1%80%E5%9D%97"><span class="toc-text">1、全局块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Events-%E5%9D%97"><span class="toc-text">2、Events 块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81HTTP-%E5%85%A8%E5%B1%80%E5%9D%97"><span class="toc-text">3、HTTP 全局块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81Server-%E5%9D%97"><span class="toc-text">4、Server 块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81Location-%E5%9D%97"><span class="toc-text">5、Location 块</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Nginx-%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B"><span class="toc-text">三、Nginx 配置实例</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/c35a7f86.html" title="脚本暂存">脚本暂存</a><time datetime="2023-02-03T12:41:14.000Z" title="发表于 2023-02-03 20:41:14">2023-02-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/90f47a19.html" title="自动化装机">自动化装机</a><time datetime="2023-02-02T12:41:14.000Z" title="发表于 2023-02-02 20:41:14">2023-02-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/64202.html" title="linux">linux</a><time datetime="2023-02-02T12:41:14.000Z" title="发表于 2023-02-02 20:41:14">2023-02-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/8fb4d8df.html" title="zabbix">zabbix</a><time datetime="2023-02-02T01:43:57.000Z" title="发表于 2023-02-02 09:43:57">2023-02-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/8d6735b8.html" title="超经典SQL练习题，做完这些你的ＳＱＬ就过关了">超经典SQL练习题，做完这些你的ＳＱＬ就过关了</a><time datetime="2023-02-02T01:43:57.000Z" title="发表于 2023-02-02 09:43:57">2023-02-02</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 壹拾陆</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>